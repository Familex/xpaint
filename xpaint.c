#define _POSIX_C_SOURCE 200809L

#include <X11/X.h>
#include <X11/Xatom.h>
#include <X11/Xlib.h>
#include <X11/Xutil.h>
#include <limits.h>
#include <math.h>
#include <stdarg.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define STB_DS_IMPLEMENTATION
#include "lib/stb_ds.h"
#undef STB_DS_IMPLEMENTATION

#include "config.h"
#include "types.h"

#define XLeftMouseBtn   Button1
#define XMiddleMouseBtn Button2
#define XRightMouseBtn  Button3
#define MAX(A, B)       ((A) > (B) ? (A) : (B))
#define MIN(A, B)       ((A) < (B) ? (A) : (B))
#define LENGTH(X)       (sizeof X / sizeof X[0])
#define PI              3.141
// default value for signed integers
#define NIL             -1

#define HAS_SELECTION(p_ctx) \
    p_ctx->tc.type == Tool_Selection && p_ctx->tc.data.sel.ex != NIL \
        && p_ctx->tc.data.sel.ey != NIL && p_ctx->tc.data.sel.bx != NIL \
        && p_ctx->tc.data.sel.by != NIL

enum {
    A_Clipboard,
    A_Targets,
    A_Utf8string,
    A_ImagePng,
    A_Last,
};

struct SelectonCircleDims {
    struct CircleDims {
        u32 x;
        u32 y;
        u32 r;
    } outer, inner;
};

struct Ctx {
    struct DrawCtx {
        Display* dp;
        Drawable screen;
        GC gc;
        GC screen_gc;
        Window window;
        u32 width;
        u32 height;
        struct Canvas {
            Pixmap pm;
            u32 width;
            u32 height;
        } cv;
    } dc;
    struct ToolCtx {
        void (*on_press)(struct DrawCtx*, struct ToolCtx*, XButtonPressedEvent const*);
        void (*on_release)(struct DrawCtx*, struct ToolCtx*, XButtonReleasedEvent const*);
        void (*on_drag)(struct DrawCtx*, struct ToolCtx*, XMotionEvent const*);
        // static zero terminated string pointer
        char* ssz_tool_name;
        i32 prev_x;
        i32 prev_y;
        Bool is_holding;
        Bool is_dragging;
        enum ToolType {
            Tool_Selection,
            Tool_Pencil,
        } type;
        union ToolData {
            struct SelectionData {
                // begin/end x/y
                i32 by, bx, ey, ex;
            } sel;
        } data;
    } tc;
    struct History {
        struct Canvas cv;
        struct ToolCtx tc;
    } *hist_prev, *hist_next;
    struct SelectionCircle {
        Bool is_active;
        i32 x;
        i32 y;
        u32 item_count;
        struct Item {
            void (*on_select)(struct ToolCtx*);
            i32 hicon;
        }* items;
    } sc;
    struct SelectionBuffer {
        Pixmap data;
        u32 width;
        u32 height;
    } sel_buf;
};

static void die(char const*, ...);
static void trace(char const*, ...);

static Pair from_scr_coords_to_cv(i32, i32, struct DrawCtx const*);
static Pair from_cv_coords_to_src(i32, i32, struct DrawCtx const*);

static void init_sel_circ_tools(struct SelectionCircle*, i32, i32);
static void free_sel_circ(struct SelectionCircle*);
static i32 current_sel_circ_item(struct SelectionCircle const*, i32, i32);
static struct SelectonCircleDims
get_curr_sel_dims(struct SelectionCircle const*);

static void set_current_tool_selection(struct ToolCtx*);
static void set_current_tool_pencil(struct ToolCtx*);

static void
tool_selection_on_press(struct DrawCtx*, struct ToolCtx*, XButtonPressedEvent const*);
static void
tool_selection_on_release(struct DrawCtx*, struct ToolCtx*, XButtonReleasedEvent const*);
static void
tool_selection_on_drag(struct DrawCtx*, struct ToolCtx*, XMotionEvent const*);
static void
tool_pencil_on_release(struct DrawCtx*, struct ToolCtx*, XButtonReleasedEvent const*);
static void
tool_pencil_on_drag(struct DrawCtx*, struct ToolCtx*, XMotionEvent const*);

static Bool history_move(struct Ctx*, Bool forward);
static Bool history_push(struct History**, struct Ctx*);

static void historyarr_clear(Display*, struct History**);
static void canvas_clear(Display*, struct Canvas*);
static void tool_ctx_clear(struct ToolCtx*);

static void
draw_selection_circle(struct DrawCtx*, struct SelectionCircle const*, i32, i32);
static void clear_selection_circle(struct DrawCtx*, struct SelectionCircle*);
static void update_screen(struct Ctx*);

[[maybe_unused]] static void resize_canvas(struct DrawCtx*, i32, i32);

static struct Ctx setup(Display*);
static void run(struct Ctx*);
static Bool button_press_hdlr(struct Ctx*, XEvent*);
static Bool button_release_hdlr(struct Ctx*, XEvent*);
static Bool destroy_notify_hdlr(struct Ctx*, XEvent*);
static Bool expose_hdlr(struct Ctx*, XEvent*);
static Bool key_press_hdlr(struct Ctx*, XEvent*);
static Bool mapping_notify_hdlr(struct Ctx*, XEvent*);
static Bool motion_notify_hdlr(struct Ctx*, XEvent*);
static Bool configure_notify_hdlr(struct Ctx*, XEvent*);
static Bool selection_request_hdlr(struct Ctx*, XEvent*);
static Bool selection_notify_hdlr(struct Ctx*, XEvent*);
static void cleanup(struct Ctx*);

static Bool is_verbose_output = False;
static Atom atoms[A_Last];

i32 main(i32 argc, char** argv) {
    for (i32 i = 1; i < argc; ++i) {
        if (!strcmp(argv[i], "-v") || !strcmp(argv[i], "--verbose")) {
            is_verbose_output = True;
        } else {
            die("usage: xpaint [-v]");
        }
    }

    Display* display = XOpenDisplay(NULL);
    if (!display) {
        die("xpaint: cannot open X display");
    }

    struct Ctx ctx = setup(display);
    run(&ctx);
    cleanup(&ctx);
    XCloseDisplay(display);

    return EXIT_SUCCESS;
}

void die(char const* errstr, ...) {
    va_list ap;

    va_start(ap, errstr);
    vfprintf(stderr, errstr, ap);
    va_end(ap);
    fprintf(stderr, "\n");
    exit(EXIT_FAILURE);
}

void trace(char const* fmt, ...) {
    if (is_verbose_output) {
        va_list ap;

        va_start(ap, fmt);
        vfprintf(stdout, fmt, ap);
        fprintf(stdout, "\n");
        va_end(ap);
    }
}

Pair from_scr_coords_to_cv(i32 x, i32 y, struct DrawCtx const* dc) {
    return (Pair) {
        .x = x + (dc->width - dc->cv.width) / 2,
        .y = y + (dc->height - dc->cv.height) / 2,
    };
}

Pair from_cv_coords_to_src(i32 x, i32 y, struct DrawCtx const* dc) {
    return (Pair) {
        .x = x - (dc->width - dc->cv.width) / 2,
        .y = y - (dc->height - dc->cv.height) / 2,
    };
}

struct SelectonCircleDims
get_curr_sel_dims(struct SelectionCircle const* sel_circ) {
    struct SelectonCircleDims result = {
        .outer =
            {
                .x = sel_circ->x - SELECTION_OUTER_RADIUS_PX,
                .y = sel_circ->y - SELECTION_OUTER_RADIUS_PX,
                .r = SELECTION_OUTER_RADIUS_PX,
            },
        .inner =
            {
                .x = sel_circ->x - SELECTION_INNER_RADIUS_PX,
                .y = sel_circ->y - SELECTION_INNER_RADIUS_PX,
                .r = SELECTION_INNER_RADIUS_PX,
            },
    };

    return result;
}

static void set_current_tool(struct ToolCtx* tc, enum ToolType type) {
    struct ToolCtx new_tc = {
        .type = type,
        .prev_x = tc->prev_x,
        .prev_y = tc->prev_y,
    };
    switch (type) {
        case Tool_Selection:
            new_tc.on_press = &tool_selection_on_press;
            new_tc.on_release = &tool_selection_on_release;
            new_tc.on_drag = &tool_selection_on_drag;
            new_tc.ssz_tool_name = "selection";
            new_tc.data.sel = (struct SelectionData) {
                .by = NIL,
                .bx = NIL,
                .ey = NIL,
                .ex = NIL,
            };
            break;
        case Tool_Pencil:
            new_tc.on_release = &tool_pencil_on_release;
            new_tc.on_drag = &tool_pencil_on_drag;
            new_tc.ssz_tool_name = "pencil";
            break;
    }
    *tc = new_tc;
}

void set_current_tool_selection(struct ToolCtx* tc) {
    set_current_tool(tc, Tool_Selection);
}

void set_current_tool_pencil(struct ToolCtx* tc) {
    set_current_tool(tc, Tool_Pencil);
}

void tool_selection_on_press(
    struct DrawCtx* dc,
    struct ToolCtx* tc,
    XButtonPressedEvent const* event
) {
    assert(tc->type == Tool_Selection);
    if (event->button == XLeftMouseBtn) {
        struct SelectionData* sd = &tc->data.sel;
        Pair pointer = from_cv_coords_to_src(event->x, event->y, dc);
        sd->bx = pointer.x;
        sd->by = pointer.y;
        sd->ex = NIL;
        sd->ey = NIL;
    }
}

void tool_selection_on_release(
    struct DrawCtx* dc,
    struct ToolCtx* tc,
    XButtonReleasedEvent const* event
) {
    if (event->button == XLeftMouseBtn) {
        if (tc->is_dragging) {
            // select area
            XSetSelectionOwner(dc->dp, XA_PRIMARY, dc->window, CurrentTime);
            trace("clipboard owned");
        } else {
            // unselect area
            struct SelectionData* sd = &tc->data.sel;
            sd->bx = NIL;
            sd->ey = NIL;
            sd->by = NIL;
            sd->ex = NIL;
            XSetSelectionOwner(dc->dp, XA_PRIMARY, None, CurrentTime);
            trace("clipboard released");
        }
    }
}

void tool_selection_on_drag(
    struct DrawCtx* dc,
    struct ToolCtx* tc,
    XMotionEvent const* event
) {
    if (tc->is_holding) {
        Pair pointer = from_cv_coords_to_src(event->x, event->y, dc);
        tc->data.sel.ex = pointer.x;
        tc->data.sel.ey = pointer.y;
    }
}

void tool_pencil_on_release(
    struct DrawCtx* dc,
    struct ToolCtx* tc,
    XButtonReleasedEvent const* event
) {
    static i32 size = 25;  // FIXME

    if (!tc->is_dragging) {
        Pair pointer = from_cv_coords_to_src(event->x, event->y, dc);
        XFillArc(
            dc->dp,
            dc->cv.pm,
            dc->gc,
            pointer.x - size / 2,
            pointer.y - size / 2,
            size,
            size,
            0,
            360 * 64
        );
    }
}

void tool_pencil_on_drag(
    struct DrawCtx* dc,
    struct ToolCtx* tc,
    XMotionEvent const* event
) {
    assert(tc->is_holding);

    Pair pointer = from_cv_coords_to_src(event->x, event->y, dc);
    Pair prev_pointer = from_cv_coords_to_src(tc->prev_x, tc->prev_y, dc);
    XSetForeground(dc->dp, dc->gc, 0x00FF00);
    XDrawLine(
        dc->dp,
        dc->cv.pm,
        dc->gc,
        prev_pointer.x,
        prev_pointer.y,
        pointer.x,
        pointer.y
    );
}

Bool history_move(struct Ctx* ctx, Bool forward) {
    struct History** hist_pop = forward ? &ctx->hist_prev : &ctx->hist_next;
    struct History** hist_save = forward ? &ctx->hist_next : &ctx->hist_prev;

    if (!arrlenu(*hist_pop)) {
        return False;
    }

    struct History const curr = arrpop(*hist_pop);
    history_push(hist_save, ctx);

    canvas_clear(ctx->dc.dp, &ctx->dc.cv);
    tool_ctx_clear(&ctx->tc);

    // apply history
    ctx->dc.cv = curr.cv;
    ctx->tc = curr.tc;

    return True;
}

Bool history_push(struct History** hist, struct Ctx* ctx) {
    trace("xpaint: history push");

    struct History new_item = {
        .cv = ctx->dc.cv,
        .tc = ctx->tc,
    };

    new_item.cv.pm = XCreatePixmap(
        ctx->dc.dp,
        ctx->dc.screen,
        ctx->dc.width,
        ctx->dc.height,
        // FIXME
        DefaultDepth(ctx->dc.dp, 0)
    );
    XCopyArea(
        ctx->dc.dp,
        ctx->dc.cv.pm,
        new_item.cv.pm,
        ctx->dc.gc,
        0,
        0,
        ctx->dc.width,
        ctx->dc.height,
        0,
        0
    );

    arrpush(*hist, new_item);

    return True;
}

void historyarr_clear(Display* dp, struct History** hist) {
    for (u32 i = 0; i < arrlenu(*hist); ++i) {
        struct History* h = &(*hist)[i];
        canvas_clear(dp, &h->cv);
        tool_ctx_clear(&h->tc);
    }
    arrfree(*hist);
}

void canvas_clear(Display* dp, struct Canvas* cv) {
    XFreePixmap(dp, cv->pm);
}

void tool_ctx_clear(struct ToolCtx* tc) {
    // do nothing
}

void init_sel_circ_tools(struct SelectionCircle* sc, i32 x, i32 y) {
    static struct Item tools[] = {
        [0] = {&set_current_tool_selection, 0},
        [1] = {&set_current_tool_pencil, 0},
    };

    sc->is_active = True;
    sc->x = x;
    sc->y = y;
    sc->item_count = LENGTH(tools);
    sc->items = tools;
}

i32 current_sel_circ_item(struct SelectionCircle const* sc, i32 x, i32 y) {
    struct SelectonCircleDims sel_rect = get_curr_sel_dims(sc);
    i32 const pointer_x_rel = x - sc->x;
    i32 const pointer_y_rel = y - sc->y;
    double const segment_rad = PI * 2 / MAX(1, sc->item_count);
    double const segment_deg = segment_rad / PI * 180;
    double const pointer_r =
        sqrt(pointer_x_rel * pointer_x_rel + pointer_y_rel * pointer_y_rel);

    if (pointer_r <= sel_rect.outer.r && pointer_r >= sel_rect.inner.r) {
        // FIXME do it right.
        double angle = -atan(pointer_y_rel * 1.0 / pointer_x_rel) / PI * 180;
        if (pointer_x_rel < 0) {
            angle += 180;
        } else if (pointer_y_rel >= 0) {
            angle += 360;
        }

        return angle / segment_deg;
    } else {
        return NIL;
    }
}

void draw_selection_circle(
    struct DrawCtx* dc,
    struct SelectionCircle const* sc,
    i32 const pointer_x,
    i32 const pointer_y
) {
    if (!sc->is_active) {
        return;
    }

    struct SelectonCircleDims sel_rect = get_curr_sel_dims(sc);

    XSetForeground(dc->dp, dc->screen_gc, 0xFFFFFF);
    XFillArc(
        dc->dp,
        dc->screen,
        dc->screen_gc,
        sel_rect.outer.x,
        sel_rect.outer.y,
        sel_rect.outer.r * 2,
        sel_rect.outer.r * 2,
        0,
        360 * 64
    );

    XSetForeground(dc->dp, dc->screen_gc, 0x000000);
    XDrawArc(
        dc->dp,
        dc->screen,
        dc->screen_gc,
        sel_rect.inner.x,
        sel_rect.inner.y,
        sel_rect.inner.r * 2,
        sel_rect.inner.r * 2,
        0,
        360 * 64
    );

    XDrawArc(
        dc->dp,
        dc->screen,
        dc->screen_gc,
        sel_rect.outer.x,
        sel_rect.outer.y,
        sel_rect.outer.r * 2,
        sel_rect.outer.r * 2,
        0,
        360 * 64
    );

    {
        double const segment_rad = PI * 2 / MAX(1, sc->item_count);
        double const segment_deg = segment_rad / PI * 180;

        if (sc->item_count >= 2) {
            for (u32 line_num = 0; line_num < sc->item_count; ++line_num) {
                XDrawLine(
                    dc->dp,
                    dc->screen,
                    dc->screen_gc,
                    sc->x + cos(segment_rad * line_num) * sel_rect.inner.r,
                    sc->y + sin(segment_rad * line_num) * sel_rect.inner.r,
                    sc->x + cos(segment_rad * line_num) * sel_rect.outer.r,
                    sc->y + sin(segment_rad * line_num) * sel_rect.outer.r
                );
            }
        }

        for (u32 image_num = 0; image_num < sc->item_count; ++image_num) {
            XSetForeground(dc->dp, dc->screen_gc, 0xFFFFFF);
            XDrawImageString(
                dc->dp,
                dc->screen,
                dc->screen_gc,
                sc->x
                    + cos(segment_rad * (image_num + 0.5))
                        * ((sel_rect.outer.r + sel_rect.inner.r) * 0.5),
                sc->y
                    + sin(segment_rad * (image_num + 0.5))
                        * ((sel_rect.outer.r + sel_rect.inner.r) * 0.5),
                "T",
                1
            );
        }

        // pointer
        i32 const current_item =
            current_sel_circ_item(sc, pointer_x, pointer_y);
        if (current_item != NIL) {
            XSetForeground(dc->dp, dc->screen_gc, 0x888888);
            XFillArc(
                dc->dp,
                dc->screen,
                dc->screen_gc,
                sel_rect.outer.x,
                sel_rect.outer.y,
                sel_rect.outer.r * 2,
                sel_rect.outer.r * 2,
                (current_item * segment_deg) * 64,
                segment_deg * 64
            );
            XSetForeground(dc->dp, dc->screen_gc, 0xAAAAAA);
            XFillArc(
                dc->dp,
                dc->screen,
                dc->screen_gc,
                sel_rect.inner.x,
                sel_rect.inner.y,
                sel_rect.inner.r * 2,
                sel_rect.inner.r * 2,
                (current_item * segment_deg) * 64,
                segment_deg * 64
            );
        }
    }
}

void clear_selection_circle(struct DrawCtx* dc, struct SelectionCircle* sc) {
    struct SelectonCircleDims sel_rect = get_curr_sel_dims(sc);

    XClearArea(
        dc->dp,
        dc->screen,
        sel_rect.outer.x - 1,
        sel_rect.outer.y - 1,
        sel_rect.outer.r * 2 + 2,
        sel_rect.outer.r * 2 + 2,
        True  // Expose to draw background
    );
}

void update_screen(struct Ctx* ctx) {
    Pair cv_pivot = from_scr_coords_to_cv(0, 0, &ctx->dc);

    XSetForeground(ctx->dc.dp, ctx->dc.screen_gc, WINDOW_BACKGROUND_RGB);
    XFillRectangle(
        ctx->dc.dp,
        ctx->dc.window,
        ctx->dc.screen_gc,
        0,
        0,
        ctx->dc.width,
        ctx->dc.height
    );
    XCopyArea(
        ctx->dc.dp,
        ctx->dc.cv.pm,
        ctx->dc.screen,
        ctx->dc.gc,
        0,
        0,
        ctx->dc.cv.width,
        ctx->dc.cv.height,
        cv_pivot.x,
        cv_pivot.y
    );
    /* current selection */ {
        if (HAS_SELECTION(ctx)) {
            struct SelectionData sd = ctx->tc.data.sel;
            XSetLineAttributes(
                ctx->dc.dp,
                ctx->dc.screen_gc,
                5,
                LineOnOffDash,
                CapNotLast,
                JoinMiter
            );
            u32 x = MIN(sd.bx, sd.ex);
            u32 y = MIN(sd.by, sd.ey);
            u32 w = MAX(sd.bx, sd.ex) - x;
            u32 h = MAX(sd.by, sd.ey) - y;
            XDrawRectangle(
                ctx->dc.dp,
                ctx->dc.screen,
                ctx->dc.screen_gc,
                cv_pivot.x + x,
                cv_pivot.y + y,
                w,
                h
            );
        }
    }
    /* statusline */ {
        struct DrawCtx* dc = &ctx->dc;
        struct ToolCtx* tc = &ctx->tc;
        XSetForeground(dc->dp, dc->screen_gc, STATUSLINE_BACKGROUND_RGB);
        XFillRectangle(
            dc->dp,
            dc->screen,
            dc->screen_gc,
            0,
            dc->height - STATUSLINE_HEIGHT_PX,
            dc->width,
            STATUSLINE_HEIGHT_PX
        );
        if (tc->ssz_tool_name) {
            XSetBackground(dc->dp, dc->screen_gc, STATUSLINE_BACKGROUND_RGB);
            XSetForeground(dc->dp, dc->screen_gc, STATUSLINE_FONT_RGB);
            XDrawImageString(
                dc->dp,
                dc->screen,
                dc->screen_gc,
                0,
                dc->height,
                tc->ssz_tool_name,
                strlen(tc->ssz_tool_name)
            );
        }
    }
}

void resize_canvas(struct DrawCtx* dc, i32 new_width, i32 new_height) {
    Pixmap new_pm = XCreatePixmap(
        dc->dp,
        dc->window,
        new_width,
        new_height,
        // FIXME
        DefaultDepth(dc->dp, 0)
    );

    XSetForeground(dc->dp, dc->gc, CANVAS_BACKGROUND_RGB);
    XFillRectangle(dc->dp, new_pm, dc->gc, 0, 0, new_width, new_height);

    XCopyArea(
        dc->dp,
        dc->cv.pm,
        new_pm,
        dc->gc,
        0,
        0,
        dc->cv.width,
        dc->cv.height,
        0,
        0
    );
    XFreePixmap(dc->dp, dc->cv.pm);

    dc->cv.pm = new_pm;
    dc->cv.width = new_width;
    dc->cv.height = new_height;
}

void free_sel_circ(struct SelectionCircle* sel_circ) {
    sel_circ->is_active = False;
}

void run(struct Ctx* ctx) {
    static Bool (*handlers[])(struct Ctx*, XEvent*) = {
        [ButtonPress] = &button_press_hdlr,
        [ButtonRelease] = &button_release_hdlr,
        [DestroyNotify] = &destroy_notify_hdlr,
        [Expose] = &expose_hdlr,
        [KeyPress] = &key_press_hdlr,
        [MappingNotify] = &mapping_notify_hdlr,
        [MotionNotify] = &motion_notify_hdlr,
        [ConfigureNotify] = &configure_notify_hdlr,
        [SelectionRequest] = &selection_request_hdlr,
        [SelectionNotify] = &selection_notify_hdlr,
    };

    Bool running = True;
    XEvent event;

    XSync(ctx->dc.dp, False);
    while (running && !XNextEvent(ctx->dc.dp, &event)) {
        if (handlers[event.type]) {
            running = handlers[event.type](ctx, &event);
        }
    }
}

struct Ctx setup(Display* dp) {
    struct Ctx ctx = {
        .dc.dp = dp,
        .dc.width = 350,
        .dc.height = 250,
        .hist_next = NULL,
        .hist_prev = NULL,
        .sel_buf.data = None,
    };

    i32 screen = DefaultScreen(dp);

    /* atoms */ {
        atoms[A_Clipboard] = XInternAtom(dp, "CLIPBOARD", False);
        atoms[A_Targets] = XInternAtom(dp, "TARGETS", False);
        atoms[A_Utf8string] = XInternAtom(dp, "UTF8_STRING", False);
        atoms[A_ImagePng] = XInternAtom(dp, "image/png", False);
    }

    /* drawing contexts for an window */
    u32 foreground = BlackPixel(dp, screen);
    u32 background = WhitePixel(dp, screen);
    // FIXME check values
    XSizeHints hint = {
        .x = 200,
        .y = 300,
        .width = ctx.dc.width,
        .height = ctx.dc.height,
        .flags = PPosition | PSize,
    };

    /* create window */
    ctx.dc.window = XCreateSimpleWindow(
        dp,
        DefaultRootWindow(dp),
        hint.x,
        hint.y,
        hint.width,
        hint.height,
        5,
        foreground,
        background
    );
    ctx.dc.screen = ctx.dc.window;

    XSetStandardProperties(
        dp,
        ctx.dc.window,
        title,
        NULL,
        None,
        NULL,
        0,
        &hint
    );

    ctx.dc.screen_gc = XCreateGC(dp, ctx.dc.window, 0, 0);

    XSelectInput(
        dp,
        ctx.dc.window,
        ButtonPressMask | ButtonReleaseMask | KeyPressMask | ExposureMask
            | PointerMotionMask | StructureNotifyMask
    );

    /* canvas */ {
        ctx.dc.cv.width = CANVAS_DEFAULT_WIDTH;
        ctx.dc.cv.height = CANVAS_DEFAULT_HEIGHT;
        ctx.dc.cv.pm = XCreatePixmap(
            dp,
            ctx.dc.window,
            ctx.dc.cv.width,
            ctx.dc.cv.height,
            // FIXME
            DefaultDepth(dp, 0)
        );
        XGCValues canvas_gc_vals = {
            .line_style = LineSolid,
            .line_width = 5,
            .cap_style = CapButt,
            .fill_style = FillSolid
        };
        ctx.dc.gc = XCreateGC(
            dp,
            ctx.dc.window,
            GCForeground | GCBackground | GCFillStyle | GCLineStyle
                | GCLineWidth | GCCapStyle | GCJoinStyle,
            &canvas_gc_vals
        );
        // initial canvas color
        XSetForeground(dp, ctx.dc.gc, CANVAS_BACKGROUND_RGB);
        XFillRectangle(
            dp,
            ctx.dc.cv.pm,
            ctx.dc.gc,
            0,
            0,
            ctx.dc.cv.width,
            ctx.dc.cv.height
        );
    }

    set_current_tool_selection(&ctx.tc);
    history_push(&ctx.hist_prev, &ctx);

    /* show up window */
    XMapRaised(dp, ctx.dc.window);

    return ctx;
}

Bool button_press_hdlr(struct Ctx* ctx, XEvent* event) {
    XButtonPressedEvent* e = (XButtonPressedEvent*)event;
    if (e->button == XRightMouseBtn) {
        init_sel_circ_tools(&ctx->sc, e->x, e->y);
        draw_selection_circle(&ctx->dc, &ctx->sc, NIL, NIL);
    }
    if (ctx->tc.on_press) {
        ctx->tc.on_press(&ctx->dc, &ctx->tc, e);
        update_screen(ctx);
    }
    if (e->button == XLeftMouseBtn) {
        // next history invalidated after user action
        historyarr_clear(ctx->dc.dp, &ctx->hist_next);
        history_push(&ctx->hist_prev, ctx);
        ctx->tc.is_holding = True;
    }

    return True;
}

Bool button_release_hdlr(struct Ctx* ctx, XEvent* event) {
    XButtonReleasedEvent* e = (XButtonReleasedEvent*)event;
    if (e->button == XRightMouseBtn) {
        i32 const selected_item = current_sel_circ_item(&ctx->sc, e->x, e->y);
        if (selected_item != NIL && ctx->sc.items[selected_item].on_select) {
            ctx->sc.items[selected_item].on_select(&ctx->tc);
        }
        free_sel_circ(&ctx->sc);
        clear_selection_circle(&ctx->dc, &ctx->sc);
    }
    if (ctx->tc.on_release) {
        ctx->tc.on_release(&ctx->dc, &ctx->tc, e);
        update_screen(ctx);
    }
    ctx->tc.is_holding = False;
    ctx->tc.is_dragging = False;

    return True;
}

Bool destroy_notify_hdlr(struct Ctx* ctx, XEvent* event) {
    return True;
}

Bool expose_hdlr(struct Ctx* ctx, XEvent* event) {
    update_screen(ctx);
    return True;
}

Bool key_press_hdlr(struct Ctx* ctx, XEvent* event) {
    XKeyPressedEvent e = event->xkey;
    if (e.type == KeyRelease) {
        return True;
    }

    switch (XLookupKeysym(&e, 0)) {
        case XK_q:
            return False;
        case XK_u:
        case XK_z:
            if (e.state & ControlMask) {
                if (!history_move(ctx, !(e.state & ShiftMask))) {
                    trace("xpaint: can't undo/revert history");
                }
                update_screen(ctx);
            }
            break;
        case XK_c:
            if (e.state & ControlMask && HAS_SELECTION(ctx)) {
                XSetSelectionOwner(
                    ctx->dc.dp,
                    atoms[A_Clipboard],
                    ctx->dc.window,
                    CurrentTime
                );
                ctx->sel_buf.width =
                    MAX(ctx->tc.data.sel.ex, ctx->tc.data.sel.bx)
                    - MIN(ctx->tc.data.sel.ex, ctx->tc.data.sel.bx);
                ctx->sel_buf.height =
                    MAX(ctx->tc.data.sel.ey, ctx->tc.data.sel.by)
                    - MIN(ctx->tc.data.sel.ey, ctx->tc.data.sel.by);
                if (ctx->sel_buf.data != None) {
                    XFreePixmap(ctx->dc.dp, ctx->sel_buf.data);
                }
                ctx->sel_buf.data = XCreatePixmap(
                    ctx->dc.dp,
                    ctx->dc.window,
                    ctx->sel_buf.width,
                    ctx->sel_buf.height,
                    // FIXME
                    DefaultDepth(ctx->dc.dp, 0)
                );
                XCopyArea(
                    ctx->dc.dp,
                    ctx->dc.cv.pm,
                    ctx->sel_buf.data,
                    ctx->dc.gc,
                    ctx->tc.data.sel.bx,
                    ctx->tc.data.sel.by,
                    ctx->sel_buf.width,
                    ctx->sel_buf.height,
                    0,
                    0
                );
            }
            break;
    }
    return True;
}

Bool mapping_notify_hdlr(struct Ctx* ctx, XEvent* event) {
    XRefreshKeyboardMapping(&event->xmapping);
    return True;
}

Bool motion_notify_hdlr(struct Ctx* ctx, XEvent* event) {
    XMotionEvent* e = (XMotionEvent*)event;

    if (ctx->tc.is_holding) {
        ctx->tc.is_dragging = True;
        if (ctx->tc.on_drag) {
            ctx->tc.on_drag(&ctx->dc, &ctx->tc, e);
            update_screen(ctx);
        }
    }

    draw_selection_circle(&ctx->dc, &ctx->sc, e->x, e->y);

    ctx->tc.prev_x = e->x;
    ctx->tc.prev_y = e->y;

    return True;
}

Bool configure_notify_hdlr(struct Ctx* ctx, XEvent* event) {
    ctx->dc.width = event->xconfigure.width;
    ctx->dc.height = event->xconfigure.height;

    return True;
}

Bool selection_request_hdlr(struct Ctx* ctx, XEvent* event) {
    trace("selection request handler");
    XSelectionRequestEvent request = event->xselectionrequest;

    if (XGetSelectionOwner(ctx->dc.dp, atoms[A_Clipboard]) == ctx->dc.window
        && request.selection == atoms[A_Clipboard]
        && request.property != None) {
        if (request.target == atoms[A_Targets]) {
            Atom avaliable_targets[] = {atoms[A_ImagePng]};
            {
                char* request_property_name =
                    XGetAtomName(ctx->dc.dp, request.property);
                trace(
                    "%d requested selection to %s prop",
                    request.requestor,
                    request_property_name
                );
                // valgrind still marks as leak
                XFree(request_property_name);
            }
            XChangeProperty(
                request.display,
                request.requestor,
                request.property,
                XA_ATOM,
                32,
                PropModeReplace,
                (unsigned char*)avaliable_targets,
                LENGTH(avaliable_targets)
            );
        } else if (request.target == atoms[A_ImagePng]) {
            trace("requested avaliable target");
            static char* test_png_image =
                "\x89\x50\x4e\x47\xd\xa\x1a\xa\x0\x0\x0\xd\x49\x48\x44\x52\x0\x0\x0\x38\x0\x0\x0\x50\x8\x6\x0\x0\x0\x4c\x21\xb6\x29\x0\x0\x0\x9\x70\x48\x59\x73\x0\x0\xb\x13\x0\x0\xb\x13\x1\x0\x9a\x9c\x18\x0\x0\x0\x7\x74\x49\x4d\x45\x7\xe1\x6\x8\x13\x2c\x4\x7b\x4\xd\x56\x0\x0\x0\x6\x62\x4b\x47\x44\x0\xff\x0\xff\x0\xff\xa0\xbd\xa7\x93\x0\x0\x1e\xf1\x49\x44\x41\x54\x78\xda\xc5\x5b\x7\x58\x54\xd7\xf3\x45\x4\x54\x6c\x88\x18\xbb\xb1\x17\x14\x35\x2a\x8a\x2d\x6a\x54\x8c\x5d\x89\xc6\x12\xa3\xc6\x8a\x88\x88\x4a\x6c\xd8\x4b\x6c\x58\xb0\x17\xc0\x46\x51\x4\xc4\x2\x62\x45\xe9\xbd\xb7\xa5\xf7\xba\xf4\x5e\x76\xcf\x7f\xee\x5b\x76\x45\x84\x8\xfe\x7f\x9a\xfb\x7d\xf7\xdb\x65\x59\xde\xbb\xe7\xce\xcc\x99\x33\x73\x1f\x52\x52\xdf\x60\xf4\xee\xdd\x9b\x7b\x9d\x38\x71\x22\xf7\x3a\x68\xd0\xa0\x91\xed\xdb\xb7\x3f\xdb\xba\x75\x6b\xef\xe6\xcd\x9b\xa7\x76\xe8\xd0\x41\xd8\xb6\x6d\xdb\xbc\x96\x2d\x5b\xfa\xb6\x6a\xd5\x2a\xa1\x59\xb3\x66\xf1\xf4\x3b\x7f\x9a\xa6\xdd\xbb\x77\xd7\x9d\x3c\x79\xf2\xf0\xa3\x47\x8f\xca\x2\x90\x5c\x73\xc9\x92\x25\x52\xff\xf9\xd8\xb9\x73\xe7\x27\x3f\x2b\x2b\x2b\xf7\x53\x52\x52\xb2\x22\x0\x90\x95\x95\x45\x93\x26\x4d\xd8\x8a\x21\x23\x23\x3\x2\xc7\xbd\xaf\x3d\xa5\xa5\xa5\xd1\xab\x57\x2f\x2c\x5b\xb6\x2c\xe8\xf0\xe1\xc3\xd3\x69\xb3\x9a\x88\xaf\xb7\x74\xe9\xd2\xff\xe\x9c\xd8\x6a\xe2\x31\x70\xe0\xc0\x89\xed\xda\xb5\xb\x66\x60\xd8\xc2\xbb\x75\xeb\x6\xb2\x16\xe4\xe5\xe5\xd1\xb3\x67\x4f\x34\x6d\xda\xb4\x4e\x80\xe2\x29\x27\x27\x7\x75\x75\xf5\x8a\xed\xdb\xb7\x6f\x5e\xbb\x76\x6d\x33\xf1\x75\x4f\x9e\x3c\xf9\xfd\xc1\x9d\x39\x73\x46\xf2\xfe\xa7\x9f\x7e\x92\x25\x0\xb\xba\x74\xe9\x12\xde\xa9\x53\x27\x74\xec\xd8\x11\x2d\x5a\xb4\xe0\x16\x4d\xa0\xd1\xaf\x5f\x3f\x88\x2d\xca\xe6\xbf\x81\x64\x73\xca\x94\x29\xd0\xd3\xd3\xd3\xbc\x74\xe9\x92\x2c\xbb\xfe\x9a\x35\x6b\xfe\x3b\x2b\x8e\x1f\x3f\x5e\x86\x62\x6b\x3\x1\xa8\xac\x76\x47\x21\x5b\x64\x9b\x36\x6d\x38\xa0\x43\x87\xe\x45\xe7\xce\x9d\xc1\x80\xb3\xa9\xa8\xa8\xf8\x45\x80\x6c\xce\x99\x33\xa7\xf4\xc0\x81\x3\x93\xc4\x31\xb9\x77\xef\xde\xef\x7\x6a\xdc\xb8\x71\xdc\xab\xad\xad\x6d\x93\xae\x5d\xbb\xce\x26\x12\x29\xae\x6b\x91\x2c\xae\xe8\x77\xd\x2\x54\x97\xbb\xd2\x7d\x6c\x37\x6f\xde\xac\xf0\x9f\x59\xaf\x4f\x9f\x3e\x3d\xc9\x52\xbe\x75\x2d\x50\x56\xae\x39\x6\xf5\xea\x82\x5f\xd5\x86\xa0\x5d\xdb\xd6\xf4\x59\x93\x2f\x82\x12\x13\x92\x78\xb2\xd8\x25\xb7\x9f\x46\x5e\xd0\xe4\xbb\x81\x1a\x39\x72\x24\xf7\xaa\xaa\xaa\x2a\x43\xd6\xd3\xad\xbd\x28\xf1\x1c\x39\xa8\x1f\x8e\xac\x9f\x83\xf\x37\xb7\x42\x6f\xed\xaf\xe8\xd2\x51\x89\xfb\xbc\x69\x53\x19\x28\x28\x28\xd4\xcb\xa6\xc\x14\x7b\x65\x3f\x13\x61\x81\x36\xf1\x43\xdf\xbe\x7d\x5b\x7f\x57\xcb\x11\xa9\x48\xd\x1f\x3e\x5c\x89\x8\xe4\x2a\x5b\x44\xed\x85\x8e\x1d\xdc\x3\x5b\x34\x26\xc0\xfa\xb2\x36\xfc\x5f\x1c\x45\x6a\xd0\xd\x1c\xdf\xf7\x7\xc5\xa4\x12\x2d\x5e\x86\x63\x57\x31\x9\x89\x81\x89\xc9\x87\x72\x27\xe8\xfa\x18\x36\x6c\x18\x66\xcf\x9e\xd\xca\x85\x20\x92\x59\xf6\xf0\xe1\xc3\x26\x14\x97\xdf\x7\xe0\x90\x21\x43\x9a\xfe\xfc\xf3\xcf\x3a\xeb\xd7\xaf\xf7\x61\xb\xa9\x9\x4e\xb1\x55\xb\x58\x9f\x5d\xb\xfd\x8d\xb3\xf0\xd8\x74\xf\xfc\x9c\xc\x20\x2c\x7c\x8c\xe4\xc8\xdb\x38\xb8\x7f\x5\x1\x6b\xce\x31\xea\x8f\x3f\xfe\x28\xf9\x1b\x96\x1f\xc5\x1b\xc5\x0\x32\x16\x9d\x3e\x7d\x3a\x96\x2f\x5f\xce\xd8\x14\x2a\x2a\x2a\xd1\xf4\xbe\xd5\x77\xb3\x20\xdd\xac\xf9\xcc\x99\x33\x53\xce\x9f\x3f\xf\xca\x59\xa0\xc4\x8e\xa6\x94\xfb\x9a\x51\xdc\x69\x2e\x1c\xf\x24\xdc\x85\xf6\x9a\x19\xb0\xbc\xbf\x1b\x69\x31\x26\x48\xc\xbf\x5\x41\x9e\x35\x22\xc9\x92\x5a\x1b\xe6\x71\x40\x18\xa3\x92\x82\x81\x9a\x9a\x1a\x16\x2d\x5a\x84\x31\x63\xc6\x70\x31\xc8\x2c\x4b\x1b\x88\x1f\x7e\xf8\x81\xfb\xce\x82\x5\xb\xb8\xcf\x28\x16\x97\xb3\x7b\x2f\x5e\xbc\xf8\xdb\x82\xa3\x78\x90\xea\xdf\xbf\xff\x14\x66\xb9\x69\xd3\xa6\x71\xbb\xcc\x18\xaf\x79\xf3\x96\xf8\x79\xe4\x10\xbc\x33\xd3\x23\x66\x77\xc0\xfa\x95\xd3\x60\x6d\xba\x1b\xc2\x2\x6b\xf8\xb9\x9c\x83\x30\xef\x11\x2a\xb3\x2d\xe1\xfd\xe1\x2\xc6\x11\xf1\xc8\x34\x95\x3\x5d\x87\xcb\x91\x73\xe7\xce\xc5\x88\x11\x23\x38\xeb\x31\xf0\xcc\xba\x62\xb\xb3\xcd\x63\xc0\x29\xe5\xf8\xd7\x4c\xfe\xdf\x6c\x90\x2b\xb1\x79\x99\xb9\x19\x3\x46\x1a\x93\x73\xb9\xce\x1d\xbb\xe0\xef\xb5\x33\x21\x48\x33\x23\x80\x76\xd8\xa9\xbb\x10\x36\x66\xbb\xc9\x72\x56\x88\xa\xbc\x86\x9c\xb8\xfb\x40\xfe\x23\x94\x65\x3e\x84\xe5\xdd\x9d\x68\x26\x2b\x87\xee\x3d\x7a\x70\x12\x8e\xf4\x28\xb3\x10\x37\x19\x28\x96\x3f\xc5\xe2\x40\xec\xc6\xc4\xd6\xa9\xf3\xe7\xcf\x1f\xf5\x5d\xf2\x1f\x25\xf6\x58\x31\x39\xb0\x5\xca\xb7\x6c\x85\xc9\x6a\x23\xf1\xf8\x96\x2e\x50\xf2\x18\xa8\x78\x2\xe3\xcb\x9b\x61\x66\xbc\x1d\x25\x19\x16\x10\xe6\x5a\xc1\xe7\xc3\x59\xa0\xd0\x8a\x40\x5a\xa3\x30\xd5\xc\x9b\x97\x4e\xa1\xbf\x65\x69\xa0\x2b\x7\x80\x6d\x14\x23\x1f\xb1\xfb\xf6\xef\x3f\x80\xdb\x40\x31\x40\xda\x84\x54\x72\xcf\x9\xdf\xdc\x82\x14\xfc\xed\x18\xe3\x31\x70\x62\x62\x68\x21\xdf\xa\x2b\xe6\x4f\x46\xc4\xfb\x33\x40\xe9\xb\xa0\xd8\x6\xa1\x5e\x17\x70\xfd\xfc\x26\x64\xc7\xdd\x23\x60\x8f\x91\x1a\x69\x8c\xb8\xd0\x1b\x28\xcf\x7a\x84\xf0\x77\x27\xc1\xb3\xd5\x87\x2\xa9\x9d\x6e\xdd\x45\xae\xc8\x62\x8e\xc5\x24\x7b\xdf\xbc\x85\x3c\xb9\xab\x22\xe7\xb2\xe2\x94\x41\x0\x5d\xc8\x45\x87\x7f\x73\x80\xb4\xcb\x1b\x45\xf9\xac\x29\xb7\xd3\xc\x6c\xcf\x1e\x3d\xb1\x66\xfe\x44\xf0\xfd\x2f\x13\xb8\xc7\x9c\x2b\xa2\xf4\x29\x8e\xe9\xaf\x44\x12\x11\xc\x8a\xac\xc9\xb2\xcf\xf1\xea\xf1\x1\xf8\x58\xed\x2\x82\xce\x23\xdf\xf9\x1f\xcc\x9e\x32\x92\x2c\x28\x12\xe1\xed\xdb\x2b\x71\xba\xf5\x97\x49\xa3\x30\x61\xec\x30\x34\x97\x6b\x81\xee\xdd\x7e\xe4\xae\xcf\x7e\x4f\x72\x4f\x7f\xdf\xbe\x7d\x6d\xbe\x19\xb0\x3f\xfe\xf8\x83\x7b\xa5\x9d\x7e\x2d\x6\x48\x89\x1e\x72\x14\x27\x63\x47\xd\xc7\xf1\x8d\x73\x90\xe5\x7d\x91\xc0\x58\x89\x0\x96\xd9\xe2\xc1\x9d\xbf\x11\xe1\x7f\xb\xc1\x9e\xd7\x60\x7e\x61\x23\x2\x9e\x1c\xc2\xb5\xa3\xab\xa1\xb5\x7c\xa\xd6\x68\x8c\xc7\x6f\x73\xc6\x63\xa8\xca\x60\xee\x1a\x3d\x7a\xfc\x88\xe1\x43\x7\xe3\xd8\xae\xc5\x8\x72\x39\x8f\xd9\xbf\xaa\x92\xd4\xeb\xcd\x59\x90\x8\xa8\x94\x88\xa8\xc7\x9d\x3b\x77\xbe\xd\x38\x47\x47\x47\xee\x95\x6a\xb5\x36\x44\xd9\x55\x62\x80\x2c\x66\xe4\xe4\x9a\x61\xd2\xb8\x51\x38\xb3\x75\x21\x12\x3e\x90\x8b\x12\xa9\x8\x18\x40\x62\xcf\xfc\x78\x53\xd8\x5e\xd7\x82\xe3\x9d\x1d\x38\xb8\x69\x1\xf6\xed\xd0\x83\x8c\x2c\xa7\x31\xb1\xfe\xaf\x95\xb8\x6c\x78\x16\x83\x6\xf6\xe7\xe2\xb8\x4f\xdf\x1\xdc\x75\xde\xdd\xd4\x26\x4f\x30\xc4\xd5\xf3\x1b\x29\xe1\xf\x43\xff\x7e\xfd\xab\x36\x6c\xd8\xb0\x65\xff\x81\x3\x4d\xc5\x9b\xfc\x3f\x1f\xc4\x6e\xe2\xfa\x4f\x93\xe2\x2e\x5b\xc\xb0\x7\xb1\x20\x3\x38\xed\xe7\xd1\xd8\xf9\xd7\xc\x9c\xd9\xb6\x18\x96\x17\x75\xf0\xda\xfa\x10\xb2\xe3\xef\x50\xec\x59\xa3\x9c\xff\x0\x89\x1\x86\x70\x7f\x6b\x82\xa4\xa4\x78\x28\xf\x52\x21\xda\x97\xc6\x90\xc1\x94\x52\x5e\x3f\xc1\x9a\xd5\xb3\x29\xc6\xa4\x89\x35\xfb\x63\xde\x2f\x6a\xb0\x39\xb9\xa\x31\x8e\xc7\xf0\xc2\x72\x2f\x7e\xfe\x59\x15\xcb\x96\xff\xa1\x7f\xe2\xc4\x89\xe6\xdf\x3c\xf6\x88\xfb\x9b\x8c\x1a\x35\xea\x24\xb9\xe5\x1b\x6\x4e\xc\xb0\x19\x55\xb\x6a\xa3\x7e\xc2\xfc\x5f\xa7\x62\xbb\xde\x2e\xcc\x98\x3a\x1d\xab\xc9\xf5\xa2\xdf\x9f\x4\x72\x1e\x92\xbb\x5a\x71\xd6\x44\xd1\x33\x40\x98\x83\x53\x27\x8e\x63\xe1\xbc\xb9\x38\x7e\x70\x27\x12\xfd\xef\x61\xd7\x96\xc5\x68\x42\xf2\x6d\x98\x8a\xa\xce\xea\x2d\x43\x90\xcd\x5e\x24\x7\xdf\xc0\x89\x83\xab\x30\x75\xea\x78\xab\x9e\xfd\xfa\x7f\x1f\x1d\x4a\x49\xfd\x57\x1e\x8f\xd7\x94\x4a\x20\x3b\x9a\x79\x2c\x36\x58\x95\xce\xa8\xfc\x97\x9\xa3\x61\x7d\xf7\x12\xd8\xb8\x69\x64\x4c\x4a\x44\x5\xf\x2e\x68\xa2\x32\xdd\x94\x4b\xb\x5c\x4c\xd2\xac\xca\xa1\xf7\x99\x4e\xe0\x7\xda\x20\xe9\x3d\x11\x8d\xef\xd\x1c\xd3\xf9\x1d\xf2\xad\x14\xb0\x64\xfe\x54\x38\x99\xef\x45\xa4\xab\x1\x1e\xde\xdf\x85\x49\x13\x47\x38\xb7\x6e\xdd\xa1\xeb\x77\x93\x67\x5b\xb6\x6c\xe1\x76\x72\xc2\x84\x9\x3b\xc7\x8e\x1d\x7b\x99\x62\xb1\x8c\x24\x55\x15\x59\x50\xf0\xcb\xf8\x51\x30\x3d\xa5\x8d\x8a\xd4\x60\x44\x87\x7\xe1\xb0\xfe\xdf\xb8\x72\xf0\x4f\x64\x45\x51\x8a\x20\x89\x6\x52\x31\x6c\xa\x73\x49\xcd\xc4\x5c\x47\x79\xe8\x65\x8\xd3\xee\x21\xdb\xcf\x10\x67\xb6\x90\x4c\x1b\x35\xc\x3a\x1b\x17\x22\x29\xcc\x4\xd6\xe6\xfa\x58\xb6\x64\x32\x74\x74\x16\x9c\x7b\xfb\xee\x4\xc7\x9a\x6b\xd7\x8a\x2a\xfa\x6f\x56\xd9\xff\xf5\xd7\x5f\x92\xf7\x93\x26\x4d\xea\xb1\x6a\xd5\xaa\x89\xca\xca\xca\x77\x89\xdd\xa2\xda\x2a\x28\x44\x75\xed\xda\xd\x1b\x67\x8f\x46\xda\x3\x3d\x44\xda\x9e\x40\x9e\xdf\x4d\xe4\x79\x5f\x40\x41\x84\x29\x2a\x63\x4d\x20\xcc\x7e\x28\x2\xc9\x91\x4f\xb5\xcb\x92\x65\x73\x78\xb7\x70\x91\x58\xf3\x4f\x8d\x19\x38\x7e\x60\xd\xcc\x4d\x76\xa7\xec\xd7\x5f\xca\xbf\x73\x5b\xb\xf7\x4d\xb7\x24\x3f\x7e\xba\xab\xbf\xf8\xbe\x94\x3\xdb\x7d\xeb\xd6\x84\xe4\xbd\xae\xae\x6e\xbb\xd5\xab\x57\xcf\x1b\x3d\x7a\xf4\x39\x72\xd7\x13\x8a\xed\x95\x4\x73\xa7\x8e\x87\xd3\x55\x6d\xc0\x87\x98\x34\xee\x26\x2a\x32\xcc\x90\x4d\x6c\x58\x16\x6c\x8\x41\x96\x85\xc4\x8a\x92\x49\xb1\x59\x18\x7f\x17\x16\x67\xd6\x61\xc2\xa8\x61\xa5\xcd\x65\x5b\x3c\x96\x92\x6a\x31\xeb\xd0\x81\x65\x67\x79\xbc\x33\x65\x26\xf7\x34\x31\x7b\xae\xda\x1e\x65\xe5\x21\x7d\xc8\x63\x3a\xd2\xa6\xfe\xf4\x4d\x80\x91\xa8\xae\xe9\xa6\xb2\x54\xca\x4c\x27\xe5\xbf\x9c\x3e\xff\x8d\xea\x35\x8d\x95\x2b\x57\x2e\x56\x1b\x33\xe6\x14\x69\xc7\x7f\x4c\xce\x6f\xf2\x2f\xf\xa1\x64\x9f\x46\xba\xb3\xc8\x6\xc2\x7c\xcb\x8f\x24\x93\x5f\xb\x20\x59\xb2\x3c\xc5\x94\x4a\xab\x8d\xa5\x7d\x7a\xf5\xbe\x33\x5d\x7d\xb6\xb2\xf2\x60\x95\xc9\x2d\x5b\xb6\xb2\xd8\xbe\x7d\x6e\xe1\xdc\x79\xaa\xe8\xd8\xe9\x87\xa\xf2\x94\x37\x54\x7\x1e\xa2\xdb\x37\x65\x6b\xa0\x4d\xfd\xdf\x81\x13\x17\x98\xbf\xfe\xfa\x6b\x5b\x2\xa0\x41\xd6\x5a\x4f\xaf\xb7\x48\x37\x5a\x50\xc\xb2\x6\xae\x2b\xbd\x77\x20\x89\x75\xa2\x59\x8b\xb6\xbf\x1c\x3b\xb4\x51\x33\xca\xd9\x80\x8f\xc\x53\x11\x20\x4a\xfa\x79\x9\xa6\xc8\x8e\x35\xa2\x6a\xc2\xf2\xa3\x9b\x52\xfa\x28\x21\x51\x6e\x6f\xa4\x3\xab\x23\x7f\xa6\x4c\x18\xad\xba\x45\x79\x88\xca\x4e\x4a\x41\x45\xd2\xd2\x1f\x5b\x8b\xa\xa\x8a\x5c\x55\x41\x1b\x1a\x47\xf1\xb7\x99\xad\xc5\xc6\xc6\xe6\xeb\x1\x51\x71\x59\x57\x7a\x68\x4a\x0\x2e\x51\x69\xf3\x27\xe5\x43\xda\x66\x65\x2d\x2\xba\x4d\x41\x41\x61\x3b\x81\x3c\x4e\xc2\x3b\x90\xb5\x19\x9a\x37\x6f\x9e\xd2\x52\xbe\xf5\xf3\x15\x4b\xa6\xc4\x7a\xbf\x3b\x45\x20\x6c\x38\x4d\x9a\x9b\x68\x9\x3e\x8f\x1\xb4\x12\x59\x93\x14\x4e\x7a\xa4\x11\xf4\x36\xcf\xc1\x5\x9d\x39\x78\x67\xb8\xae\x68\xcc\x90\xfe\x7e\x32\x32\x72\x29\x8c\x99\x59\x37\xae\x85\xbc\xa8\xda\x67\xd5\x5\xbb\x36\x6b\x5e\x91\x6\x2e\x5b\xb1\x62\x5\x97\xe9\xe7\xcd\x9b\xd7\x38\x60\x86\x86\x86\x52\x54\x9a\x70\xef\x2d\x2c\x2c\x64\x8\x68\x9b\x6d\xdb\xb6\x71\x2e\xb1\x63\xc7\x8e\x1f\xc8\x52\xa5\x83\x6\xd\x1a\x67\x60\x60\xd0\x57\x5d\x5d\x7d\x2\xed\xea\x3a\x45\x45\x45\x3d\x2\x67\x42\xd5\x78\x84\xb8\xd1\xcb\x1a\x4b\x54\xf8\xa\x46\xc\xeb\x2b\x34\xba\xa4\x83\xca\x5c\xb2\x5a\xe9\x73\xca\x87\x4\xac\xc4\x96\xf2\xa0\x3d\x5e\xda\x1e\xc5\x9c\x19\xaa\x98\x33\x76\x20\xfc\x8c\xb6\x60\xd7\x8a\x69\x98\x34\x7e\x2c\x7a\x90\xd0\x66\x4d\x62\x26\xe0\xc5\xd\x62\x6\x90\xd5\x82\x54\x83\x72\x25\xd5\xdf\x7f\xff\x9d\x4c\xcc\xdd\xe9\xab\x2d\x48\xd5\x73\x7\xda\x9d\xb1\x5b\xb7\x6e\x55\xac\xd9\xd8\x25\x37\xbc\x43\x37\xf0\x25\x71\x1d\x4c\x96\xf3\xa0\xdc\xe7\xc9\x5a\x85\x62\xa5\x5f\xd7\x54\x6a\xaf\x80\xcd\xeb\xe7\x20\x3e\x94\xc4\x76\xd9\x73\x4\x7b\x5c\x82\x8e\xd6\x7c\x5a\x6c\xf\xf4\xfe\x41\x11\xae\x97\xd6\xe1\xce\xee\x45\xe8\xa4\xd4\x11\xa3\x54\x55\xb9\x1e\xc\x93\x70\xac\x16\xe4\x5a\x1f\x8a\x8a\x9c\xe5\xd8\x3d\x58\xd1\xcb\x1a\x55\x13\x27\x4e\xc4\x41\x1a\x8d\xed\xaf\x88\x65\x58\x3f\x72\xbf\x35\x4\xb2\xf3\x81\x3\x7\xa4\x6b\x80\xd3\x22\x81\x6d\x4d\x37\xf3\xa4\x1d\x7d\x47\x2e\x14\x4f\x6e\x53\xf9\xd1\x6a\xf5\xcf\x66\x24\xe3\x7e\x1a\xda\x7\x93\x27\xc\xc1\x10\xe5\x3e\x90\x66\x55\x41\xbb\xb6\x78\x78\x70\x39\x59\x4f\x1b\xbd\x3a\xb5\xe7\xac\xde\xad\x7b\x37\x2c\x5d\xba\x14\xc4\xcc\x5c\x65\x3f\x78\xf0\x60\xfc\xfe\xfb\xef\x24\xd5\x7e\x6\x79\x9\x7\x92\x7d\xc6\x2a\x8b\x25\x4b\x96\x78\x36\xda\x72\x6a\x6a\x6a\xcd\x88\x3c\x16\x93\x32\x59\x27\xfe\x4c\x47\x47\xa7\x25\x4b\x1\x7d\xfa\xf4\xb9\x49\xbb\xe9\x46\xa0\x72\x8\x54\x36\xdd\xac\x84\xdd\xb0\xbe\x76\x61\x7d\xb3\x65\xf3\x16\x18\xad\xfc\x23\xce\x68\xce\x44\xac\xa9\x2e\x96\xfe\x22\x6a\x56\xb1\x7e\xb\xdd\x83\x2b\x78\x99\xa5\x98\x3a\xa2\xc2\x16\x33\x66\xcc\xe0\xba\x6b\xe2\x22\x98\xb5\x47\xd8\x77\xe9\x7b\xde\x8d\x6\x48\x40\xba\xd1\x3c\x49\x56\x9c\x2f\xfe\x8c\x76\x4c\x97\x74\xe7\x5b\x76\xf4\x45\x80\xca\xbf\xa6\x3b\x5d\x73\x76\xef\xd0\xe\xef\x2e\xae\x45\xc8\xed\x2d\xd8\xbb\x6c\x12\xd7\x1f\x95\x21\x8b\x74\xaf\x8e\xbd\x9a\x2d\x44\x66\x35\xf6\x39\x63\x50\x6\x96\x75\xc7\xc3\xc2\xc2\xc0\x9a\x5c\x53\xa7\x4e\xb5\x68\x74\x2b\x9f\x8\x44\x81\x76\xe6\x22\x5\xf8\xeb\x99\x33\x67\xe\x23\xb0\x9a\x54\x4d\x27\x50\xac\x9\xc4\x67\xd\xff\x36\xd9\xce\x52\x8e\x44\x54\x54\x14\x52\x53\x53\x61\x6c\x6c\x84\x25\xcb\x96\x51\x1c\x2a\x61\xda\x88\xfe\x98\x3d\x66\x10\xfe\x98\x36\x12\xce\x17\xd7\xe3\xd1\xa1\xe5\xe8\xac\xa8\x0\xa9\x26\x32\x9c\xc5\xd8\xb9\x45\xed\xeb\x31\xf7\x67\x96\x24\x3e\xe0\xba\x76\xac\xeb\x56\x51\x51\x81\xa2\xa2\x22\x18\x19\x19\x65\x53\xd2\x57\x6e\xb4\x15\x29\xd\x8c\x20\x80\x3e\xec\xe2\xe4\x7e\x42\xe6\x82\x4d\x9b\x12\x89\x50\x69\xd3\x44\xaa\xfe\x63\x2f\xd6\x56\xb8\x7d\xfb\x36\x6a\xe\x7e\x76\xe\x9e\x3d\xbe\x89\x1b\x87\x56\xc2\xee\xf8\x2a\x38\x9c\x5c\x89\xbb\xbb\x16\xc2\xed\xba\x26\x46\xf6\x65\x2e\xd7\x94\x8b\xcf\x1\x3\x6\xd4\x79\x4d\xd6\xbe\x60\x2e\xca\x36\x8c\x81\xb\xe\xe\x86\x50\x28\xe4\xae\x5d\x5e\x5e\x2e\x78\x45\xe3\xab\xb4\x29\xed\x58\x73\x72\x8d\x2d\x64\x41\xc3\x7e\x7d\x7\x3c\x93\x6f\xd1\xba\x4c\x9a\x76\xba\x49\x75\xcc\x89\xa7\x78\x21\x8c\xd2\xa9\xca\xe6\x6e\x5c\x5a\x56\x6\x61\x35\x40\x17\x17\x47\x44\x4\xde\xa1\xdc\xf7\x0\xce\xf7\xb7\x22\xca\x7c\x2b\xdc\xae\xad\x87\x9a\x72\x57\x22\x1a\x59\x8e\x21\x59\xdc\xd5\x6c\x2a\x89\x1b\xc0\xfd\xfa\xf5\x85\x96\xe6\x3a\x44\x84\x87\xc2\xcd\xd5\x95\xc0\x5\xa1\xaa\xaa\x4a\x72\x6d\x36\x72\x72\x72\xb2\x29\x9c\xfa\x37\xc6\x7a\x1f\xdb\xf2\x23\x86\x2f\xa4\x74\x10\xdf\x94\x6a\xb4\xd1\xa3\x6\x42\x6b\xdd\x1c\x74\xed\xd2\x29\xa9\x5d\x3b\xc5\xb\xfd\xfb\xf\x30\x97\x97\x6f\x29\xac\x6e\x2\xe1\xda\xb5\x6b\xdc\xd\x53\xd2\xd2\x11\x12\x11\x8e\x9c\xd2\x62\x54\xd2\xcf\xde\x5e\x76\x48\x8e\x30\xe2\xba\x68\x85\xa9\xf\xb0\x6b\xd3\x5c\x28\xb4\x92\x87\x9c\x8c\x1c\xab\xd0\x39\x20\xb4\xc0\x4f\x5c\x9c\x35\x7b\x77\xef\xde\x8b\xb7\xf6\xf7\xc0\x8f\x35\x83\xc5\xfd\x83\xb0\xb2\x7a\x80\xbc\xbc\x3c\x54\x56\x56\x82\x5f\x90\x8f\xa2\x12\xb6\x89\x42\xe6\xae\x25\xa6\xa6\xa6\x7b\xd8\x7a\xe7\xce\x9e\xdb\xf0\x83\xcc\x21\x43\x6\xf\x6b\xd9\xaa\xb5\x7b\xdb\x36\x6d\xa1\xa7\xbd\x8\x19\x3c\x13\x14\xc7\xdf\x83\x95\x91\xce\xc2\x81\x3\x7\x68\x50\x2\x16\x88\x89\x80\xd1\x3a\x1b\x45\xe5\x65\x70\xb\xe\xc5\x7b\xf\x4f\x84\xc4\xc5\x23\xa3\xb0\x18\x5e\x1e\xe\x8\xf1\xbe\x6\x9b\x7\xfb\xa0\x36\x56\x45\x44\x1e\x94\x22\x28\xd6\x39\xf\x60\xcd\x25\xf1\x75\x98\x3b\xee\xde\xbd\x1b\xf9\xf9\x79\xe0\xf3\x93\xe0\xf1\xc2\x10\x2f\x6e\x6a\x63\xc4\xe0\x5e\xdc\x77\x18\xe1\x3c\x7d\xfa\x4\x2\x81\x10\xa9\xfc\x1c\x44\xa7\xa7\xa2\xb8\xa4\x44\xe8\xec\xec\xfc\xaa\xb1\xf9\xb0\x33\x5d\xec\x91\x48\xb\x4a\x43\x7b\xe5\x34\x78\xdb\xe8\x23\xe2\xcd\x9\x3c\xba\xae\x9b\xbc\x70\xde\xb8\x14\x19\x19\x59\xa1\x38\x46\x32\x32\x32\x38\x80\xa9\xd9\xd9\x78\x4e\xae\xe4\xf0\xc1\x9\x1e\xa1\xa1\x88\xa3\x9f\xc3\xc3\xfd\x61\x7c\xe5\x6f\x3c\xb5\xdc\x87\xf9\x73\x27\x72\x72\x8b\x81\x62\xa\x85\x31\x22\x63\x48\xe6\x9e\x93\x27\x4f\x86\xad\xad\xad\xc8\xed\xf8\xd9\x88\xf5\xb1\x44\x59\xd4\x75\xfc\x3e\x7f\x1c\x17\xfb\x4a\x1d\x94\x28\xf1\xff\x80\x99\xb3\x66\xa1\xa4\xac\x94\xfb\x5e\x64\x5c\x1c\x7c\x23\x22\xc0\x8b\x8a\x8a\x67\x2d\xda\xea\xea\xe6\xcb\x0\x89\x45\x17\xd3\x42\xa\xc8\x5d\xa\xc8\x1d\x29\xdf\xb4\xc7\x7d\xc3\xcd\xc8\xf2\x30\x80\x8b\x99\x1e\xbc\x5f\x9e\xc4\x58\xd5\xe1\x18\x3e\xfc\x27\x90\xb4\x93\xc4\x43\x2a\xb9\xe7\xc5\x5b\x46\xb0\xb2\x77\x80\x8b\x8f\x1f\x59\xb4\x2\x5\x64\x8d\xac\x14\x17\x98\x5c\xdb\x6\xe5\x41\xfd\x30\x6a\xd4\x28\xce\x12\x5c\xba\x20\x70\x8c\x98\x34\x35\x35\x91\x99\x99\x29\xb9\xe\xb3\x60\xa8\x97\xd\x6e\x9d\x5e\x8f\xa1\x83\x7a\xd3\x26\x76\xe4\xc2\x40\x8e\x36\x45\x95\x14\x4e\x68\x62\x2\xa\x4a\x4a\x50\x51\x55\x89\xc8\x98\x68\x78\xf8\xf8\x65\x1f\x3c\x74\x90\x7b\xc\xe3\xcd\x9b\x37\x52\x14\x2e\xff\x7a\x90\xd9\xb1\x47\x8f\x1e\x7b\x89\x34\xc\x49\x2a\x79\xb0\x5\xc8\xca\x8a\xda\xe6\xfa\xdb\x7f\x43\x61\x8c\x29\xfc\x9f\xec\x81\x9d\xe5\x35\x8e\xd1\xd8\x10\xb3\x5a\x71\x71\x31\x9e\xd8\xbf\xc0\x51\x3\xda\x8\x77\xf\xc9\x82\xd9\xe2\xe7\xcf\x5f\x0\x55\xd5\xd1\x5c\x1b\x5e\x1c\x6f\x2c\x71\x9b\x98\x98\x48\xbe\x57\x55\x25\x10\x31\x2f\x3f\x3\x89\x21\x36\xb8\x70\x68\x5\x7e\x68\xdf\xee\x93\x3\xd1\xc1\xc3\x86\xc2\x39\x2c\x14\x1e\x51\x91\x88\xce\x48\x43\x71\x59\x5\x12\xe2\x13\xab\xcc\x2c\xcc\x9e\xee\xd8\xb6\x43\xa1\x21\x24\xd3\x8f\xe2\x63\x83\x8a\x8a\x4a\x67\xda\xe1\x87\x6c\x97\x59\xe0\x4b\x53\x32\x1e\xd8\xab\x1b\x6e\xec\xfb\x13\xe1\xe\x87\x71\xff\xd6\x3f\x24\xa5\x46\xe2\xe9\x93\x27\xe4\x32\x65\xc8\x20\x2\xc8\x29\x2a\x86\xcd\xb3\xe7\x58\xba\x6c\x29\xd2\xd2\xd2\x24\xb\x77\x71\x71\xc1\xe9\xd3\xa7\x9\xa0\x2a\x27\xb1\x98\x9b\xb2\xc5\x1e\x3a\x74\xe8\x23\x38\x81\x80\xac\x42\xc4\x44\xaf\x15\x44\x24\x91\x81\xe\xd8\xb4\x4a\x1d\xed\x89\x65\x99\x10\x10\x6f\x4a\xdb\x76\xa\x70\xa\xd\x81\x47\x74\x14\x3c\x69\x86\xc4\x27\xa2\x88\xee\x9f\x97\x9f\x27\xb0\xb7\xb7\xbf\xfa\x45\x80\x54\x31\x77\xa2\x39\x89\xbd\x27\xa\xff\x83\xe2\xa3\x40\x94\xe3\x14\xb9\x36\x7a\xa7\xce\x1d\x11\xf4\xea\x58\xf9\xfd\xb3\xdb\x4c\xd7\xfc\xb5\xb2\xf0\xe8\x56\xd\x84\x5\x12\x85\x27\xa6\xc0\x95\xe2\xe1\x91\x9d\x1d\x6c\xac\xad\x3f\xc9\x85\xee\xee\xee\xb8\x74\xe9\x12\xe8\xba\xdc\x22\x99\x50\x66\x16\x61\x9b\x40\xb9\x8c\x51\xbd\x28\xbd\xd0\xfb\xf4\xdc\x3c\x24\xa6\x67\x20\x33\xc9\x9\x5b\xd7\xcf\x90\x54\x26\x35\x53\x88\xb9\xbd\x1d\xfc\xe3\xe3\x91\x42\x31\x9e\x99\x97\x8f\xfc\xe2\x12\x6e\x83\xe8\x3a\x4c\xba\x75\xf8\xd2\xa1\x4a\x47\x9a\x1c\xc0\xa1\x43\x87\xf6\xa2\xd2\xe9\x6d\xed\x33\xf3\xdf\x66\x8d\x63\x17\x6a\xf5\xc4\x68\x6f\xa2\x30\xe0\x2c\x42\x9f\x9f\x40\x28\x2f\x82\x76\x36\x14\xaf\xde\x7f\xa0\xb8\xcb\x97\x80\x63\xb4\xce\x2c\xf8\xfc\xf9\x73\x9\x40\x66\x4d\x76\x5a\xfb\xf4\xe9\x53\x44\xd0\xa6\xa4\xa7\xa7\x4b\x5c\x3d\x95\x8\xc6\x2b\x22\x12\x1e\x5e\xf6\x38\x7f\x68\xd\x7a\x76\xed\xf8\x9\x38\x46\x4c\x53\x28\xf1\x7b\x87\x84\xa2\xf6\xe0\xf3\xf9\x91\xda\xda\xda\xdc\xa9\x10\x95\x73\x75\x3\xd4\xd0\xd0\x50\xa2\xa9\x2a\xfe\x99\xb4\xa1\x41\xcd\x87\x76\xb8\x4\x2f\x2d\x13\xf0\xfc\x9a\xee\xa9\x3c\xd7\xe3\x25\x42\x3f\x3\x54\x79\x9f\x86\xa7\xfd\x4d\xb8\xd1\xc2\xbc\xfc\x7c\x3f\xb9\x29\x5b\x3c\x3\xc8\x98\x96\x55\x5\xec\x1a\x76\x64\x65\x27\x27\x27\xbc\x78\xf1\xe2\x13\x57\x66\xa3\x8c\x18\x32\x34\x36\x16\xaf\xbd\x3d\xe0\x11\xf0\x1\x73\xe7\xcc\x90\xdc\x9b\x89\x70\xf1\xa3\x27\x7f\xae\x5a\x45\xe9\x42\xf0\xc9\xdf\x12\x7\x8\x3c\x3d\x3d\x8d\xe9\xf7\x2d\x45\xea\x66\xed\xe7\x0\x37\x6c\xd8\x20\x4b\xb3\xad\xf8\x67\x4a\x3\xab\xc8\x4d\xf9\xb5\x24\x54\x95\x8b\xcd\x41\xa2\xcd\xbb\x10\xc4\x1a\xa1\xca\xe7\x14\x12\xdf\x9c\x81\xc3\xdb\x37\xc8\x2f\x28\xf8\xe4\xa6\xf1\xe4\x4a\x6c\x32\x4b\x7a\x78\x78\x70\x35\xde\x91\x23\x47\x50\x42\x2c\x28\x2\x54\xc6\x4d\x9\x40\x72\xd3\x34\x7e\x26\xbc\x88\xc0\x7c\x13\xe2\xb1\x87\xbe\xdb\x82\xaa\xf\x96\x27\x47\x8f\x1e\x2d\x39\x18\x65\x1b\x7d\xf8\xf0\x11\x44\x46\x47\x23\x86\x66\x79\x45\x25\xf7\xf7\x85\x85\x85\x5\xc4\xa4\x9b\xea\xb4\x1e\xd5\x60\x9f\xbd\xa7\xa\x7a\x0\x59\xd0\xa3\xb6\x46\x7c\xf3\xe4\x8\xd7\x76\x10\xe6\x58\x42\x10\x64\x88\x42\x77\x3\xbc\x7f\x61\xf5\x9\x38\xc6\xad\x61\x91\x91\xc8\xcc\xca\x92\x7c\xc6\x5c\x95\x2d\x94\xa5\x97\x47\x8f\x1e\x71\x95\x81\x98\x85\x39\xb1\x50\x5a\x86\xd4\xdc\x1c\x64\x64\xf3\xe1\xee\xe7\x87\x67\x8e\xef\xb1\x68\xc5\xa\xfc\x48\x82\x9b\x15\xc2\x35\x9f\x71\x6b\xd9\xaa\xd\x56\x2f\xd3\xa0\xd4\xa3\x8a\xe3\xfa\xba\x78\x66\x71\x15\x36\x96\x66\xb8\x71\xd3\x28\xf4\x82\xe1\x99\xb1\xd\x4a\xfa\x9b\x36\x6d\xea\x42\xac\xea\xc8\x7c\x9f\xed\x5e\x7b\x52\xfd\x3f\xd\x1d\x88\xf4\xe8\x3b\xd5\x5d\x31\x2\xc8\xbb\x86\x62\xaf\xb3\x8\xf6\x72\xfc\x4\x60\x39\xe9\x46\xdf\x90\x60\xc4\xb0\xbc\x55\x5a\x22\xd1\x90\xa4\x3c\x40\xaa\x9\x7e\x4\xa0\xa0\x96\xc5\x49\x99\x20\x94\x2c\x9e\xc0\xe7\x23\x8f\x24\x59\x30\x6d\xd0\xf1\x73\x17\xd0\xbb\x6f\x5f\x9\xb8\x26\x4d\x44\x0\xfb\x74\xeb\x0\xf7\xfb\x3b\xa0\xb7\x46\x1d\x1e\xf7\x74\x91\xe4\xb0\x1f\xef\x4d\xf\xc0\xfc\xee\x2d\x3c\xb3\x7f\x71\x5a\xdc\x7d\xab\x73\xc\x1f\xae\x22\x4e\xfa\x1a\x54\x8b\x25\xb3\x54\xc1\xce\x1f\x7a\xf6\xec\x8d\xa9\x93\xc7\xa0\x82\x6f\xc9\x9d\x1e\xb1\x76\xa0\x20\xec\x32\x8a\xbd\xd\x11\x1e\xe0\xfd\xe9\x62\x29\xd1\x7b\x6\x4\x20\x3a\x31\x1e\x61\xc9\x49\x28\x2c\x2d\x95\xfc\x2e\x37\x37\xf7\x13\xcb\x89\x47\x6\x1\x73\xb\xc\x80\x4f\x4c\xc\x92\x88\x25\x4b\xc8\x65\x23\x78\x91\x5c\xb\x43\x4c\x74\xd2\xdc\xab\x34\x9e\x5c\xdc\x0\x4\x5f\x44\x66\xc8\xd\x44\xbe\x3f\x81\x1c\x97\xe3\xa8\x4a\xb9\xb\x97\x77\x37\xf2\x4e\x9f\x3e\xb9\xaa\x41\x16\x6c\x29\x2f\x7f\x45\x56\x46\xf4\x28\xa4\x8c\xac\xc\xe5\x24\x59\x74\x50\x6c\x4b\xc2\xf9\x21\xd7\xf6\x13\x66\x58\x40\xe0\x6b\x80\x42\x1f\x43\xb8\x7b\xba\x20\x85\x68\xbe\xb0\x5c\x4\xa4\xb0\xb4\x1c\x6e\x7e\xfe\x88\x23\x70\x41\x89\x89\x8\xa4\x98\xca\x23\x31\x50\x5c\x5e\x86\xba\x46\x19\xc5\x51\x68\x74\xc\x9c\xc9\xb2\x9e\x4c\xa1\x50\x9e\x8b\xcb\x12\x29\x9c\x27\x94\x6f\x6b\x3e\x87\x73\x66\xbb\x6\x2a\x7d\xce\xa0\x32\xce\x88\xeb\x8c\x17\x24\xdf\x43\xf0\xeb\xe3\x88\xfa\x70\x1a\x69\xbc\xbb\x70\xb0\x3f\xad\xfd\x45\x70\x3\x6\x29\xf7\x90\x96\x96\x7b\xf9\x31\xf6\x44\x8d\xa5\x3e\xdd\x3b\x21\x37\xd9\xc\xc2\x5c\x6b\xb2\xde\x45\xc0\xef\x14\xf2\x3d\xcf\xc1\xc6\xee\x9\xbc\xc9\xbd\x42\x92\x12\x48\x61\x94\x72\x0\xdf\x79\xfa\x20\x89\x98\x32\x2c\x25\x19\xee\xa4\x3e\x42\x8\x68\x66\x61\x3e\x32\x72\x73\x3e\x3\x58\x44\x16\xf6\xc\xe\x81\xab\xbf\x3f\x7\xd0\x9d\x0\x7a\x90\x8b\xe6\x93\x80\x60\x63\xca\x94\x29\xb1\xad\xdb\xb4\xcd\xbd\xb4\x6b\x29\x4a\x3c\xce\x40\x10\x79\x3\x82\x7c\x4b\x49\x3\xb9\x32\xeb\x21\x12\x82\xae\xc3\x95\x74\xb3\x9d\xd1\x8e\xc0\xeb\xff\x6c\x1c\xf9\xaf\x0\xd5\xd5\x47\x2b\x1d\x3d\xb0\xda\x76\xbc\x9a\x32\x5a\x50\xf1\xdb\xa3\x93\x2\xb6\xff\x31\x5\xe\x57\x37\xa1\x2a\xf3\x21\xaa\xc2\x2f\x41\xe0\x77\x1a\x95\xde\xa7\x5\xef\xcd\xf6\x64\x9a\x58\x5a\x95\xfb\xc4\x93\x0\x8e\x8d\x47\x4e\x61\x21\xa\xcb\xca\x61\xef\xe4\x8a\x64\x4a\x15\x3c\x9a\xee\xd1\xcc\x2a\xd1\x8\x4b\x4a\x42\x1a\x25\xe8\xd8\x5a\x29\x22\xa7\xb8\x8\xce\x54\xf3\x31\x80\x1e\x1c\xc0\x48\xf8\x93\xa0\x66\xb1\x1c\x18\x18\x98\x7d\xe9\xf2\x65\x56\xbd\xcb\xb9\xde\xdb\xe9\x29\xf0\x23\x80\x49\xf7\xc8\x7a\x36\x35\x8e\x0\x1e\x71\x3d\x57\x1\xf1\x42\x90\xcb\x45\xdc\x38\xbf\xef\x74\x9d\xc0\xd6\xae\x12\x75\xb1\xcd\xee\xec\xd1\x48\x8\x35\xce\x10\xe6\x59\xa3\x34\xf1\x3e\xca\x83\xae\x42\xe8\x7f\x16\x91\x36\x3b\x91\x4f\xc2\x5b\x48\xae\x29\xf0\x39\xd\xde\xb3\x83\x79\x7b\x77\x6e\x3d\xe2\xe8\xe9\x49\xb\x8b\x45\x60\x62\x12\x17\x3b\x5\x54\xb3\xbd\xf1\xf6\x21\xb7\x8b\x46\x42\x66\x16\xbc\x69\xb1\xcc\xed\xd8\xc\x4d\x4a\x24\xb\x97\x48\xd8\x96\x8b\xcb\xa2\x22\x2a\xb7\x42\xe0\x16\x10\x8\x37\xb2\x36\x9b\x71\xfc\x2c\xa4\x51\xe\xb5\xb2\xb2\x5a\x49\xe9\x4a\x86\xad\xeb\x98\xce\x92\x91\x99\x8e\xff\x0\x49\x77\x3f\x5\x58\xe3\x28\x20\x37\xf1\x2e\x2c\xef\x1d\x49\xfc\xc\xdc\x43\x73\x89\x12\x97\xf7\x72\x32\xb8\x51\x94\x66\x4e\x7f\xf0\x88\x23\x13\x6e\x66\x99\xa3\x94\x12\x7b\xb8\xd5\xdf\xa8\xf2\x3d\x43\x2a\xe6\x40\xfa\xbe\x6d\x7f\xce\xb6\xb3\x7f\x6e\x14\x14\x15\xc5\x59\x28\xa6\xba\x7c\xca\xa5\x7a\x30\x20\x3e\x1\x8e\x5e\x9e\x48\xa5\xcf\xfc\x99\x5\x69\xd1\x22\x1d\x19\x4d\x6c\x99\x40\xda\xb3\x8a\x8a\x57\x91\xb\x16\x53\x3e\xe4\x25\x25\x93\x4a\x9\xc1\x2b\x1f\x6f\xda\xac\x28\x64\x53\xcc\xba\xb8\xb8\xbe\x3c\x77\xee\x2c\x77\xb4\x7c\x4a\x6f\x5\xb7\x38\xeb\xf3\xda\xb7\xab\xc2\x2f\xd3\x9a\xac\x3f\x7\xc8\x66\xf9\x63\xbc\xb4\xd8\x83\x7a\xdd\xf3\x9e\xf1\x4e\xf5\xe8\x80\x6b\x29\xec\xec\x40\x72\xa6\xc7\xb9\x0\xf9\x7a\xd0\x45\xf8\x5a\xec\x84\xdb\xe3\x83\xa1\xd3\xc7\xa9\xf4\xf4\xd\xe4\xb5\xf3\xf5\xf3\x2b\x8c\xcb\x4c\xa7\x58\x4b\x21\xf1\x5b\x2e\x1\x18\x98\x90\x44\x6e\xea\xc4\x9\x0\x5e\xc\x59\x90\xc7\x83\x57\xb5\x15\xd9\xcc\x2e\x2c\xa0\xd8\x2b\xe1\xc0\x55\x10\x58\x3e\xb9\xa9\x4f\x58\x8\x9e\x93\xfa\x9\x4a\x4e\x41\x28\xc5\xa0\xc3\xcb\x17\x9f\xf5\xe7\x17\xa9\x4f\x52\xa\x7a\xa2\x5f\x82\x4c\xf3\x8f\x87\x39\xb9\x34\xb3\x1e\x88\xe\x7c\xf8\x16\x8\x74\xbe\xe0\x5b\x2f\x40\xb7\x37\x67\xb6\xa4\xf2\x8c\x44\xa7\x41\x1c\x40\x2b\xee\x51\x2c\x64\x99\x81\x67\x7f\x14\x66\x97\xf4\x3c\xa5\xa4\x14\xe4\xab\xdb\xfd\xf3\x48\x41\x7c\x46\x1a\xb9\x44\xe\x1\x24\xc2\xad\xdf\xbc\x43\x7a\x16\x9f\xfb\xcc\xd3\x2f\x0\x6e\xe1\x11\x5c\x25\xc0\x66\x6c\x5a\x6\x27\x94\xe3\xd2\x33\x9\xa0\x80\xe2\xad\x12\xc1\x11\x3c\xbc\xf1\xf2\x2\x8f\xac\xfe\xde\xc5\xed\x99\xc1\xa9\xd3\xdd\x39\x50\x8b\x16\x71\x6b\x5b\xf7\xdb\xc\xee\xf5\xe2\xa1\xd5\xdb\x8a\x42\xaf\x71\x2e\xc9\x36\x1f\x19\xe6\x10\x12\xf1\x8\x83\x2e\x0\xa1\x97\xe1\x6c\xb6\xe3\x76\x7d\xf8\x9a\xb8\xd9\x1d\xdf\x9f\x17\x75\x9b\xc4\xa4\x5\xfd\xa1\x19\x90\xfd\x40\x74\xa1\xd8\x5b\x78\x7c\x73\x7f\xe6\xf4\x99\x8b\x3b\xb2\x2f\x92\x1a\x91\x25\x6d\x79\xaf\x2e\xda\xe7\x17\x16\xc1\x3f\x21\x1\xcf\xdc\xdc\xb8\x84\xcd\xe4\x9a\x80\x8\xc3\xd1\xcd\x3\xae\x54\xd3\x79\x11\x91\xf8\x51\xbe\x63\xf1\x1a\x4f\x24\x14\x4f\x55\x4\x6b\x29\xc5\x52\x3a\x71\xf2\xf5\x45\x70\x5c\x2\x5e\xbe\x75\xdc\x5e\x5f\xc2\x7e\x76\x75\xaf\xec\xb\xa3\xed\xae\x65\x9\x14\x8b\xec\x60\x35\xde\x8\x2\xcf\x93\x10\xbc\xda\x7\xe1\xcb\xfd\x70\xbd\xb4\xc6\xa0\x5e\xb\xba\x5b\xee\xd9\x96\xf6\xfe\x18\x10\x78\x16\xc2\x10\xda\x91\xf8\x5b\x28\x8d\x36\x42\xd2\xfb\xd3\x59\x37\xce\x69\x73\x5b\x39\x56\x4d\x4d\x8a\x2a\x83\x76\x54\xf8\x16\xd7\x5\x30\x83\x72\xa2\x17\xe5\x35\x8f\xb8\x18\xbc\x75\x73\x41\x36\xa5\x86\x72\x2a\x6a\x8b\x89\x4c\xde\xb9\xba\x51\xe1\x1a\x46\x20\x63\x10\x97\x96\x8e\x1c\x4a\xfc\x7e\xb4\x9\x8c\x49\xf3\xa9\xb6\x74\xf6\xf1\xc1\x1b\x57\xb7\x4a\x5f\x1f\xdf\x99\xdc\xb3\x39\x7f\xd6\x9d\xb7\xb5\x96\xa8\x77\x7d\x63\xb4\xcd\xa1\xc0\xef\x7c\x49\xa5\x8f\x1\xf0\x6a\xf\x8a\x2d\xb4\xc0\x37\xd6\xc4\xbb\xa3\x4b\x3f\x67\xd1\x3d\xdb\x44\x17\x7a\x76\x61\xd3\xbc\x18\x9b\xbd\x5\x55\x6f\xf\xa1\xec\xa5\x3e\x72\x5d\xff\xa9\xa\xb4\xdc\xe3\x7d\x6c\xeb\x2\x75\xf1\x77\x77\xef\xde\x2d\x75\xea\xd4\xa9\x85\x62\xe1\x5c\x7b\x24\x91\x2a\xf1\x8a\x8a\x46\x48\x72\x2a\xec\xa8\x8c\xe2\x13\x88\xc4\xec\x2c\x94\x93\x2b\xb2\xc6\xed\x7\x6f\x6f\x38\x53\x89\xc5\x52\x41\x36\x95\x58\x21\xf4\xdd\x20\x7a\xcf\xc6\x3b\x8a\xdb\xeb\xc6\xc6\x61\x3e\xde\xde\xaa\x75\x1\xdb\xb6\xaa\xe6\x3\xb1\x9d\x9b\x99\x1e\x5d\x7b\x28\xde\x7c\x5b\x62\xb1\xf9\x6\x64\x1b\xaf\xc7\x87\xc3\xcb\x70\x7d\xbd\xfa\x89\x7a\x2d\xb8\x57\x53\x63\x88\xdf\x3\x7d\xef\x24\xeb\x9d\xe0\x19\x6f\xc8\x78\x75\x75\xf3\x95\x25\xbf\xab\x4b\x9e\x74\xd0\xd2\x14\x1d\x5d\x90\x7b\x3e\xa9\xb\x1c\xa3\xfe\x18\x72\xbb\x48\x22\x1d\x96\xc7\xfc\xc3\x79\x48\x24\xd2\x48\xc9\xce\x41\x34\xc5\x5d\x25\xc9\xb4\x22\xb2\x96\x1b\x49\xb9\xf\xe4\xae\xbc\xd4\x34\xf0\x73\xf2\x38\x15\x93\x4e\x84\xe4\xf8\xde\x11\x6b\xd7\xae\xf5\x98\x33\x7b\x8e\x4a\xbd\xff\x88\xa2\xb5\x44\xa\x42\x53\xc9\xcf\xc7\x75\x34\x26\xfb\x5d\xdf\x68\x1f\x69\xa2\x5d\xf0\xea\xe4\x5f\xc9\xd7\xb4\xe7\x6a\xd4\xdf\xf8\x9d\xab\xde\xd6\xee\xf2\x26\x4d\x37\x63\xed\xfb\xd7\xf4\x57\xb0\x7\x50\x25\xf\x83\x6f\x5a\x36\x8d\x7b\x9d\x35\x6b\x56\x87\x98\x98\x98\xf2\xba\x0\x96\x53\xbc\xc5\x90\xeb\x65\x57\x93\x4f\x5\x1\x72\x27\xe2\x60\x4d\xe1\xe0\xf8\x44\x44\x13\x81\x30\x2d\xca\x18\xd4\x83\x4\xb9\x3b\x81\xcc\x24\xd7\xe4\x51\x2d\xe8\x4e\xae\x1b\x46\x69\x64\xdd\xba\xb5\x8c\x5\xbf\xf8\xd0\xdd\x9e\xf5\x92\x63\x14\xa9\xd9\xf3\xa6\x29\xdd\x3f\xb9\x41\xd3\xf2\xdc\xe6\xb9\x9d\x7\xfd\x28\x57\xe7\x1f\x1c\xda\x5a\xf7\xff\x9\x9d\xd8\x2a\x7a\xc2\x76\xc5\xa\x51\x2e\xba\x72\xe5\x8a\x56\xed\xa2\x53\x3c\xa\x8a\x4b\x88\x21\x33\xb9\xf2\x47\x3c\x3c\x28\x1f\xb2\xda\x8f\xc5\x99\x3b\xc5\x5b\x22\x9f\x5f\x5d\x41\x10\xdb\x52\x65\x1f\x42\xee\x99\x43\xa\xc7\xd5\x97\xf4\x6b\x46\x3a\x6c\x1e\xdb\x84\x8d\x1f\x37\x9e\x7b\xe0\xe0\xe4\x89\x13\xff\xa\xf2\xf0\xb6\xbf\xa4\x10\xd8\x88\x7\xf2\xb7\xac\x5e\xf0\xe9\xa3\x93\xe3\x86\xd6\x3c\xca\xe6\x5e\xa9\x52\xf7\x47\x3d\x83\x11\x4c\x34\xb9\x1d\xb3\xa4\x78\x64\x11\xa0\x38\x2\x21\x10\xa\xc0\x23\x77\x65\x69\x22\x95\xdc\x92\x3\x49\x96\x8c\x88\x8b\xa7\x62\x97\xbe\x43\x7a\xd5\x27\x2c\x1c\x29\x19\x99\x65\x6f\x5e\xbf\x66\xa2\x59\xee\xbb\xff\x9f\x4\x15\xc4\x2a\x54\xf2\xd4\x69\x3e\x1\xb9\x5e\x1c\xb9\x60\x1c\xe7\x86\x9f\xfe\x8e\xd5\x80\xcc\x35\xb\x49\xc6\xf9\x12\x83\xfa\x92\xb4\x63\x9b\xc1\x46\x9\x81\x4c\x23\x69\x96\x9b\x9f\x7\x3f\x8a\xd9\x58\xda\xa0\x80\xc0\xc0\x44\x1b\x2b\x6b\xee\xf1\x8e\x7f\xfe\x39\xf1\xed\x81\x89\x1f\x4\xb2\xb5\xb5\xbd\x50\x9f\xf5\x4a\xa8\xe\xc\x23\xb\xa5\x12\x6b\xd6\x1e\xec\x94\x28\x97\x62\x8d\xe1\x4e\xe6\xe7\xc0\x25\x32\x82\xc4\x79\x1c\xd2\xf3\xf3\xaa\x4b\xa6\xa\x4e\xd1\x24\xa4\xa4\xc2\x8b\x40\x86\x90\x2b\x7b\x78\xb8\x2f\xfa\xee\x16\x8c\x8e\x8e\x4e\xa9\xf\x60\x2e\xe9\xc7\x20\x92\x68\xb9\x45\x9f\xa7\x47\x96\xec\xfd\x2\x3\x45\xef\x29\x27\x46\xa6\xa7\xc2\x35\x92\x7\x5f\x72\x5d\x7e\xd\x35\xc4\x7a\xa3\x81\x64\x61\x8f\xd0\x30\x18\x9b\x9a\x69\xd1\x2d\x65\xbe\x1b\xb8\xeb\xd7\xaf\xcf\xa9\x60\xa7\x90\x75\xa6\x7\x21\x92\x73\xb2\x39\x4d\x5a\x5c\x56\x82\x72\x2a\x6e\x6b\x13\x91\x27\x9\xe9\x8a\xca\x2a\x49\x5b\x23\x2d\x27\x17\xee\x24\xac\x83\x12\xe2\x48\xc7\x7e\xac\xfa\x33\x29\x3e\xfd\x89\x55\x6f\x3e\xb4\x30\x9c\xb7\x58\xa3\xed\x37\x7\x26\x66\x4f\x7f\x7f\xff\x7\x14\x47\x82\xba\xab\xf2\xa\xae\xde\x8b\xa0\x5a\x2f\xaf\xa4\x8\xa5\x75\x54\xef\x4c\xb5\xf8\xd4\xe8\x6b\xb2\x98\xcd\x27\xb1\x10\xcc\xc8\x85\x59\xb2\xa0\xb0\xba\x4f\xa\x8e\x69\x8d\x1f\x5a\x3c\xd7\xd2\xd3\xed\xfc\xd5\xb\x6f\xec\x3f\x1d\xf2\xf9\xfc\xf4\xba\xfa\x29\xdc\xe2\x49\xa1\x78\x93\x22\x9\xa0\xa2\x37\xa3\x46\x3\xb8\xf6\xf8\xe0\xe5\xcd\xb5\xfa\x6b\xda\x9e\xc5\x2e\xab\x1b\xb3\x6b\x35\xa2\xec\xdf\xbe\x8e\x33\xb8\x7c\xb1\xf\xbb\xf7\x46\xad\x4d\x8d\x7e\x1e\x46\xfc\xec\x59\x33\x23\x23\x23\x2d\x6f\x6f\xef\x4c\x57\x57\x57\xcf\x5b\xb7\x6e\xe9\xaa\x8d\x51\x1b\x72\xea\xe4\xa9\x79\x2f\xec\xed\x2f\x3b\x3b\x7f\xb0\x77\x73\x76\x79\x75\xef\xde\x3d\xdb\x72\xd6\x6f\xaf\xcb\x7a\x54\x9\x84\xa5\x52\x4c\x51\xb5\xc0\x4b\x4e\xe2\x6a\xbd\xfa\x46\x44\x54\xc\xc9\xb2\xd8\x3a\x15\x50\xed\x91\x45\x2e\x7f\xc7\xf4\xfe\xc6\x76\xed\x15\x65\xbf\xd6\x88\x4d\x8\x90\x6a\x12\xb9\xd6\x27\x4d\xdb\xc4\x4\xdc\xb7\x30\xc3\x6d\x73\xb\xca\x4b\x91\x5c\x21\xeb\x13\x18\x20\x39\x9f\x13\x2d\x47\xc8\x1d\x98\xe4\x52\xf2\x8e\x26\x69\xf6\xd6\x3f\x0\x4e\x14\x63\xc5\x65\x65\xf8\xb7\x51\x45\x1e\xf0\xce\xc7\x97\xa\xda\x42\x34\x64\x38\xb9\xba\x44\x99\x5a\x98\x77\xf9\x2a\x74\x7\xe\x1c\x90\xb3\xb4\xb4\x3c\x2a\x8e\x87\xda\xdb\xc8\x5a\x7c\xd7\x6f\x99\x60\xe5\xfa\x8d\x30\x7f\xf4\x10\x11\x54\x2\xf1\xd2\x52\x11\x9f\x95\x49\x1a\x32\x19\x9e\xe4\x92\x4e\xe1\x61\xb0\x73\x71\x86\x7f\x1d\x67\x6\xf5\x8d\x70\x2a\x87\x22\x28\x1d\x34\x64\xb0\xfe\xa9\x89\x89\xc9\xfa\x99\x33\x67\x36\x9e\x4d\x9\x9c\xbc\x87\x87\x87\x33\x3b\xb0\xc\x27\xf6\xcb\x29\x2a\xe4\xac\xc2\x8e\x8a\x99\xea\xa8\xaa\x8e\x37\x63\x13\x63\x44\x12\x75\x7\x10\x11\xb0\x96\x83\x6b\x58\x4\xdc\x48\x62\xd9\xb9\x3a\xe1\x83\xbb\x3b\x6d\x44\xe\x1a\x33\x58\xab\x82\xa5\x1\x76\x90\xd9\x90\xe1\xe9\xe9\x19\x7b\xf7\xee\x5d\xa5\x46\x81\xd3\xd7\xd7\x6f\xfb\xfc\xd9\xb3\x31\x11\x94\x50\x83\x13\x12\xe1\x12\x11\x6\x37\x12\xbb\x9e\xbc\x48\x4\x52\x2d\xe7\x4b\xf1\xe4\x16\x14\x2\x7\x27\x67\x5c\xbc\x72\x85\x7e\xe6\xc1\x9d\x2a\x6e\x77\x7a\xb5\x77\xfc\x40\x94\xef\xc7\x75\xa0\xbf\x76\x30\x61\x9d\xde\xc0\x8d\x61\x65\x19\xa5\xa8\x8d\x7a\x7a\x7a\xd2\x3a\x3a\x3a\xd\x3\xf8\xf2\xe5\xcb\xeb\x11\x11\x11\xc5\x15\x94\x8f\xc2\x8\x90\x67\x70\x30\x5c\x49\x4e\xb9\x78\xfb\xc0\xc6\xce\xe\xdb\xf7\xee\x81\xc1\xf9\x73\x8\xa1\xcf\x6d\x6c\x6c\xf0\xd2\xf1\x3d\x9c\x3d\x3d\x10\x18\x1c\xca\xe5\xbc\x3a\x73\x21\x59\xbc\x3e\x11\x5e\xfb\x7b\xcc\x82\xfe\x44\x38\xd\x1d\x5e\x5e\x5e\x89\xfb\xf7\xef\x6f\xf8\x23\xcd\xff\xba\x63\xa4\x48\xd8\xe1\x65\x42\x7c\xbc\x28\x5f\x35\x70\xd1\xac\x62\xa8\x47\x7\x7c\x36\x12\x29\x2d\x3c\x73\x71\x45\x71\x45\x65\x83\xad\x48\x55\x8c\x66\xf5\xff\x2e\x7e\x3d\xc0\xd2\xd2\x52\x50\xad\x87\xba\x9a\x49\xff\x6\x8e\x9d\xd3\xb3\xd9\xd0\xc1\xe\x65\xbc\x49\x70\xa7\xe5\x16\x34\xc6\x8a\x3c\x5a\xba\xf4\x57\x5b\x90\xe9\xc5\x4\x62\xca\x9a\x4f\x3e\x34\x64\xb0\xcd\x60\x8c\xdb\x10\x4b\x4b\xee\x45\xdf\xd\x4b\x4c\x46\x2a\x3f\xb7\xc1\x7f\xc3\xee\xa1\xab\xab\xfb\xb\x5b\xff\xaa\x55\xab\x1a\x7\x90\x59\x81\x94\xa\x6a\xe7\xc4\x2f\xd\x66\x35\xb6\x21\xd\x75\xcd\x9a\x89\xbd\xb0\xa4\x94\x18\xb5\xb4\x51\x7f\xe7\xe0\xe0\xe0\xf2\x55\x16\x64\xf1\xc3\xc0\xd5\x23\x56\xea\x5\xc7\x8e\xa8\xcb\xea\x48\xee\xcc\x9a\xf5\xc9\xba\xff\xcf\x60\x8f\x75\x9d\x3d\x7b\x76\x56\x75\x1e\x6f\x18\x40\xb6\x18\x66\x3d\xf1\x53\xf\xd\x19\x6c\x23\x98\xe5\xca\xea\x51\x2e\x8c\x14\x1a\x6b\xd5\x6\xa7\x18\x77\xf7\x2f\x3e\x10\xfb\x7f\xc3\x84\xfb\x29\x55\xc4\x64\x76\x0\x0\x0\x0\x49\x45\x4e\x44\xae\x42\x60\x82";
            static i32 test_png_image_size = 8036;

            XChangeProperty(
                request.display,
                request.requestor,
                request.property,
                request.target,
                8,
                PropModeReplace,
                (unsigned char const*)test_png_image,
                test_png_image_size
            );
        }
        XSelectionEvent sendEvent = {
            .type = SelectionNotify,
            .serial = request.serial,
            .send_event = request.send_event,
            .display = request.display,
            .requestor = request.requestor,
            .selection = request.selection,
            .target = request.target,
            .property = request.property,
            .time = request.time,
        };
        XSendEvent(ctx->dc.dp, request.requestor, 0, 0, (XEvent*)&sendEvent);
    } else {
        trace("xpaint: invalid selection request event received");
    }
    return True;
}

Bool selection_notify_hdlr(struct Ctx* ctx, XEvent* event) {
    static Atom target = None;
    trace("selection notify handler");

    XSelectionEvent selection = event->xselection;
    target = None;

    if (selection.property != None) {
        Atom actual_type;
        i32 actual_format;
        u64 bytes_after;
        Atom* data;
        u64 count;
        XGetWindowProperty(
            ctx->dc.dp,
            ctx->dc.window,
            atoms[A_Clipboard],
            0,
            LONG_MAX,
            False,
            AnyPropertyType,
            &actual_type,
            &actual_format,
            &count,
            &bytes_after,
            (unsigned char**)&data
        );

        if (selection.target == atoms[A_Targets]) {
            for (u32 i = 0; i < count; ++i) {
                Atom li = data[i];
                // leak
                trace("Requested target: %s\n", XGetAtomName(ctx->dc.dp, li));
                if (li == atoms[A_Utf8string]) {
                    target = atoms[A_Utf8string];
                    break;
                }
            }
            if (target != None)
                XConvertSelection(
                    ctx->dc.dp,
                    atoms[A_Clipboard],
                    target,
                    atoms[A_Clipboard],
                    ctx->dc.window,
                    CurrentTime
                );
        } else if (selection.target == target) {
            // the data is in {data, count}
        }

        if (data) {
            XFree(data);
        }
    }
    return True;
}

void cleanup(struct Ctx* ctx) {
    historyarr_clear(ctx->dc.dp, &ctx->hist_next);
    historyarr_clear(ctx->dc.dp, &ctx->hist_prev);
    XFreeGC(ctx->dc.dp, ctx->dc.gc);
    XFreeGC(ctx->dc.dp, ctx->dc.screen_gc);
    XFreePixmap(ctx->dc.dp, ctx->dc.cv.pm);
    if (ctx->sel_buf.data != None) {
        XFreePixmap(ctx->dc.dp, ctx->sel_buf.data);
    }
    XDestroyWindow(ctx->dc.dp, ctx->dc.window);
}
